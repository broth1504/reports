<?xml version="1.0" encoding="utf-8"?>
<Report MustUnderstand="df" xmlns="http://schemas.microsoft.com/sqlserver/reporting/2016/01/reportdefinition" xmlns:rd="http://schemas.microsoft.com/SQLServer/reporting/reportdesigner" xmlns:df="http://schemas.microsoft.com/sqlserver/reporting/2016/01/reportdefinition/defaultfontfamily">
  <df:DefaultFontFamily>Segoe UI</df:DefaultFontFamily>
  <AutoRefresh>0</AutoRefresh>
  <DataSources>
    <DataSource Name="DataSource1">
      <ConnectionProperties>
        <DataProvider>SQL</DataProvider>
        <ConnectString>Data Source=anapdlprem;Initial Catalog=Accounting</ConnectString>
        <IntegratedSecurity>true</IntegratedSecurity>
      </ConnectionProperties>
      <rd:SecurityType>Integrated</rd:SecurityType>
      <rd:DataSourceID>460f36ab-580a-4e49-835d-1203c016ea74</rd:DataSourceID>
    </DataSource>
  </DataSources>
  <DataSets>
    <DataSet Name="DataSet1">
      <Query>
        <DataSourceName>DataSource1</DataSourceName>
        <CommandText>USE Accounting



-- clean temp tables

if object_id ('tempdb..#firstColStartDates') is not null drop table #firstColStartDates

if object_id ('tempdb..#LastActivity') is not null drop table #LastActivity

if object_id ('tempdb..#WCPolicies') is not null drop table #WCPolicies

if object_id ('tempdb..#MaxEndmtNumHistory') is not null drop table #MaxEndmtNumHistory

if object_id ('tempdb..#PolicySubDataPrepared') is not null drop table #PolicySubDataPrepared

if object_id ('tempdb..#CPPPolicies') is not null drop table #CPPPolicies

if object_id ('tempdb..#Policies') is not null drop table #Policies

if object_id ('tempdb..#cancWCpol') is not null drop table #cancWCpol

if object_id ('tempdb..#WCPremInvAmts') is not null drop table #WCPremInvAmts

if object_id ('tempdb..#cancCPPpol') is not null drop table #cancCPPpol

if object_id ('tempdb..#CPPPremInvAmts') is not null drop table #CPPPremInvAmts

if object_id ('tempdb..#PremInvAmts') is not null drop table #PremInvAmts

if object_id ('tempdb..#WCAcctRecT') is not null drop table #WCAcctRecT

if object_id ('tempdb..#WCAcctRecTT') is not null drop table #WCAcctRecTT

if object_id ('tempdb..#CPPAcctRecT') is not null drop table #CPPAcctRecT

if object_id ('tempdb..#CPPAcctRecTT') is not null drop table #CPPAcctRecTT

if object_id ('tempdb..#AcctRecT') is not null drop table #AcctRecT

if object_id ('tempdb..#AcctRecTT') is not null drop table #AcctRecTT

if object_id ('tempdb..#WCMaxPremPaidDate') is not null drop table #WCMaxPremPaidDate

if object_id ('tempdb..#CPPMaxPremPaidDate') is not null drop table #CPPMaxPremPaidDate

if object_id ('tempdb..#MaxPremPaidDate') is not null drop table #MaxPremPaidDate

if object_id ('tempdb..#PreTotals') is not null drop table #PreTotals

if object_id ('tempdb..#canc') is not null drop table #canc

if object_id ('tempdb..#Totals') is not null drop table #Totals

if object_id ('tempdb..#minHistories') is not null drop table #minHistories

if object_id ('tempdb..#firstColStartDates') is not null drop table #firstColStartDates

if object_id ('tempdb..#AFSICommissionPreparedInitial') is not null drop table #AFSICommissionPreparedInitial

if object_id ('tempdb..#AFSICommissionPrepared') is not null drop table #AFSICommissionPrepared

if object_id ('tempdb..#AFSICommissionLoaded') is not null drop table #AFSICommissionLoaded

if object_id ('tempdb..#PayablesPrepared') is not null drop table #PayablesPrepared

if object_id ('tempdb..#DueClearedPrepared') is not null drop table #DueClearedPrepared

if object_id ('tempdb..#PayablesPreparedFinal') is not null drop table #PayablesPreparedFinal

if object_id ('tempdb..#PayablesPreparedTypes') is not null drop table #PayablesPreparedTypes

if object_id ('tempdb..#RefComCalcBasisLookupPrepared') is not null drop table #RefComCalcBasisLookupPrepared

if object_id ('tempdb..#currentComCalcBasisPrepared') is not null drop table #currentComCalcBasisPrepared

if object_id ('tempdb..#RefComCalcBasisLookupPreparedCPP') is not null drop table #RefComCalcBasisLookupPreparedCPP

if object_id ('tempdb..#calcComBasisCPPCurrentPrepared') is not null drop table #calcComBasisCPPCurrentPrepared









Declare @EOMDate datetime 

set @EOMDate = '12/31/2019'

declare @UseDateCancOffset bit = 1


--declare @EOMDate DATE = '12/31/2019'; -- change by EDW - JC



DECLARE @PrevEOMDate DATE = NULL;









---/////////////////////GET FIRST COLLECTION DATE FOR ALL POLICIES///////////////////////////////

--JKS 7/16/2019 - as of May 2019 a new status of 55 (Flagged As Entered in Error) was added to the Collections system so policies

--that were entered into Collections by mistake are not excluded from Commission calculations





select 

min(ActionHistoryID) as ActionHistoryID,

CollectionID,

CAST(null as smalldatetime) as ActionDate

into #minHistories

from collections.dbo.CollActionsHistory (nolock)

group by CollectionID



update a

 set 

a.ActionDate = b.ActionDate

from #minHistories a left JOIN collections.dbo.CollActionsHistory b (nolock)

on a.ActionHistoryID = b.ActionHistoryID







select c.PolicyID, c.LOB, min(c.FirstCollectionDate) as FirstCollectionDate

into #firstColStartDates	

from (

	select *

	from collections.dbo.LastActions cc (nolock)

	cross apply (   	    

					---------------NEW-------------------------------

					SELECT 

					mh.ActionDate as FirstCollectionDate

					FROM #minHistories mh 

					WHERE mh.CollectionID = cc.CollectionID					

					) a

	--limit to just the WC and CPP Collections because there are Assigned Risk and NGIC collections in the db

	where cc.LOB in('WC', 'CPP')

	--exclude Collections that were marked as entered in error

	and cc.ActionID &lt;&gt; 55

	) c

group by c.PolicyID, c.LOB

option (maxdop 16);



DROP TABLE IF EXISTS #minHistories;

--------------------------------------------------------------------------------------------------





---//////////////////////GET THE VALUES USED FOR THE THE LATEST ACTIVITY INCLUDING SUMS OF THE ALLOCATED FIELDS/////////////////////////

---For the new process we migrated totals from the old commission process (AgtCommission)

---The migration potentially inserted one of 4 records

---		1. Previous Balance - RecType PRVBL - amount owed on the May 2019 statement out of the old system

---			a. One caveot was for policies that started as Agency Bill and switched to Direct Bill that had TransType 3 records

---				in AgtCommission, since those were replicas of the Agency Bill AcctRec records the Paid amounts threw off the calculated

---				commission and the policies consistently showed a large due back amount, for those we used the new calculations to 

---				determine what the amount SHOULD have been

---		2. Commission Kept - RecType OTHER, Descr Total CommKept - this is the sum of PaidCom out of AcctRec for Agency Bill payments

---		3. Direct Bill Commission Paid - RecType OTHER, Descr Total PaidCom - this is the sum of all the TransType 4, Bordereau = 0 records from AgtCommission

---		4. True Up Adjustment - RecType OTHER, Descr True Up Adj - we took the updated calculations that used the proper table values and calculated 

---				how much commission SHOULD have been paid in the old process less what was Paid + Kept to bring the starting allocated amounts 

---				to a correct starting amount so future allocations have proper values to work with

---For new activity, I confirmed we are filling in all of the LastActivity values with the actual values that exist at time of processing

---This includes the new logic for scenarios such as:

---		1. Premium Audit is processed, but no AR activity has happened after the audit. The cost changing values of the Audit are not included until AR activity

---				this follows the old process because previously all policies (except AgtGroup 64) switched ComCalcBasis to CP after audit, but no true up was processed

---				until there was AR activity. 

---		2. When a policy is either Audited or DateCanc + 30 days is achieved we automatically switch the ComCalcBasis over to CP and initiate a True Up Adjustment

---		3. When a policy's rate changes we initiate a Rate Change adjustment based off of all the prior allocated Premium (PaidPrem) X New Rate - sum of prior allocated Commission (CommKept)



--declare @EOMDate DATE = '12/31/2019'

select 

SourceGrpID,

PolicyID,

LOB,

MasterAgtID,

AgtID,

MAX(CommissionID) as CommissionID

into #AFSICommissionPreparedInitial

from Accounting.dbo.AFSICommission a (nolock)

WHERE 

cast(EnteredDateTime as date) &lt;= @EOMDate

and a.StatementDate &lt;= @EOMDate

and a.TransType &lt;&gt; 13

and 1 = case

			--JKS 1/15/2020 - if the policy has any records other than Paid/Kept Commission from cut over, ignore the cut over records
			when not exists(select distinct 1
							
							from Accounting.dbo.AFSICommission ac (nolock)

							where a.PolicyID = ac.PolicyID

							and a.LOB = ac.LOB

							and ac.Descr not in ('Total PaidCom', 'Total CommKept')) 
							
				and a.Descr in ('Total PaidCom', 'Total CommKept') then 1

			--JKS 1/15/2020 - if the policy ONLY has cut over records, go ahead and use those
			when a.Descr not in ('Total PaidCom', 'Total CommKept') then 1

			--JKS 1/15/2020 - the only things that should get excluded are the cut over records for policies with other activity
			else 0
		end


GROUP BY 

SourceGrpID,

PolicyID,

LOB,

MasterAgtID,

AgtID




		CREATE NONCLUSTERED INDEX [IX_AFSICommissionPreparedInitial_CommissionID] ON #AFSICommissionPreparedInitial 

		( CommissionID ASC )

		WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF , SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF , ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

		ON [PRIMARY];



		



SELECT 

d.*

into #AFSICommissionPrepared

from #AFSICommissionPreparedInitial a 

left join Accounting.dbo.AFSICommission  d (nolock)

on d.CommissionID = a.CommissionID







--Declare @EOMDate datetime = '12/31/2019'

-------GET THE ORIGINAL AND LAST PAYABLE FOR EVERY STATEMENT/WRITE OFF SO WE CAN DETERMINE ITS STATUS

SELECT 

MAX(PayableID) as PayableID,

ParentID,

ParentType,

--JSON_VALUE(SupportingInfo, '$.ORIGPAYABLEID') as SupportingInfo,
isnull(a.OrigPayableID, a.PayableID) as OrigPayableID,
--a.OrigPayableID,

cast(NULL as varchar(100)) as PayableStatus

into #PayablesPrepared

from Accounting.dbo.Payables a (nolock)

WHERE cast(EnteredDateTime as date) &lt;= @EOMDate

--JKS 11/13/2019 - only 4's (statements and offsetting payments) or 11's (write offs) are eligible to determine a Payable Status
--TransType 1, 2 are Credit Balance Payments and NSF's from those received payments
--TransType 14 are Bonus and Profit Sharing payments
and a.TransType in(4, 11)

GROUP BY

ParentID,

ParentType,

--JSON_VALUE(SupportingInfo, '$.ORIGPAYABLEID')
isnull(a.OrigPayableID, a.PayableID)
--a.OrigPayableID


----FIND OUT WHAT THE ORIGINAL PAYABLE WAS AND WHAT THE TYPE OF THE LAST ACTION SO WE CAN FIGURE OUT ITS STATUS

SELECT 
--pp.*, 
--op.TransType as [Original TransType], op.RecType as [Original RecType], op.StatementAmt as [Original StatementAmt], op.EnteredDateTime as [Original EnteredDateTime], 
--just grab the whole original record so we don't have to start with Payables again for #PayablesPreParedFinal
op.*,
mp.PayableID as [Last PayableID], mp.TransType as [Last TransType], mp.RecType as [Last RecType], mp.StatementAmt as [Last StatementAmt], mp.EnteredDateTime as [Last EnteredDateTime],
pp.PayableStatus

INTO #PayablesPreparedTypes

FROM #PayablesPrepared PP

INNER JOIN Accounting.dbo.Payables op (nolock)

	on pp.OrigPayableID = op.PayableID


INNER JOIN Accounting.dbo.Payables mp (nolock)

	on pp.PayableID = mp.PayableID

	

--select *
--from #PayablesPrepared


--SELECT

--	p3.ParentID,

--	p3.ParentType,

--	p3.EnteredDateTime

--	into #DueClearedPrepared

	
--	FROM Accounting.dbo.Payables p3 (nolock)
	
--	WHERE p3.TransType = 4

--	AND p3.StatementAmt &gt; 0

--	AND cast(p3.EnteredDateTime as date) &lt;= @EOMDate

--	--JKS 1/15/2020 - when checking whether a DUE statement has been cleared, we should only be considering it cleared
--	--if there is a Statement with a positive balance
--	--The only RecTypes that designate a Statement has generated are DUE and CPBL
--	AND p3.RecType in('DUE', 'CPBL')






update p2

set p2.PayableStatus =	case
										--JKS 11/13/2019 - added CTRFR (Commission Transfer) to the Outstanding Types, and moved the Stop/Void/Return types to a new bucket
										--so the values for those details are not included in the Current Due
										when p2.[Last RecType] in('CPMT', 'EPMT', 'CREIS', 'EREIS', 'CSGL', 'ECHT', 'USTOP', 'UVOID', 'CTRFR') then 'Paid' --BConnolly - Adding outgoing escheatments

										when p2.[Last RecType] in('CPBL') then 'Outstanding' 

										when p2.[Last RecType] in('CRTN', 'ERTN', 'VOID', 'STOP', 'SECHT', 'VECHT') then 'Waiting to reissue'

										when p2.[Last RecType] = 'WROFF' then 'Written Off'

										
										--validate all other DUE's except June 2019 separately
										when p2.[Last RecType] = 'DUE' 

											and p2.StatementDate &lt;&gt; '6/30/2019'
										
											and isnull(dc.DueCleared, 0) = 0 then 'DUE'

										when p2.[Last RecType] = 'DUE' 

											and p2.StatementDate &lt;&gt; '6/30/2019'
										
											and isnull(dc.DueCleared, 0) = 1 then 'Cleared'


										--June DUE and it was paid in July, but has no other positive statements since, it is still DUE
										when p2.[Last RecType] = 'DUE' 

											and p2.StatementDate = '6/30/2019'

											and c.PaidInJulyByMistake = 1

											and f.ValidClearAfterJuly is null then 'DUE'

										--June DUE and it was paid in July, but has a valid positive statement after, it is Cleared
										when p2.[Last RecType] = 'DUE' 

											and p2.StatementDate = '6/30/2019'

											and c.PaidInJulyByMistake = 1

											and f.ValidClearAfterJuly = 1 then 'Cleared'

										--June DUE w/ no July Activity and has no other positive statement, it is still DUE
										when p2.[Last RecType] = 'DUE' 

											and p2.StatementDate = '6/30/2019'

											and c.PaidInJulyByMistake is null

											and f.ValidClearAfterJuly is null then 'DUE'


										--June DUE w/ no July Activity but a valid positive statement after, it is Cleared
										when p2.[Last RecType] = 'DUE' 

											and p2.StatementDate = '6/30/2019'

											and c.PaidInJulyByMistake is null

											and f.ValidClearAfterJuly = 1 then 'Cleared'


										else 'Unknown'

									end

from #PayablesPreparedTypes p2
outer apply (select distinct 1 as DueCleared
				from #PayablesPreparedTypes ppt 
				where p2.ParentID = ppt.ParentID
				and p2.ParentType = ppt.ParentType
				and p2.RecType = 'DUE'
				and 1 = case
							when json_Value(p2.SupportingInfo, '$.MIGRATED') = 1
								AND ppt.StatementDate &gt; p2.StatementDate then 1
							when json_Value(p2.SupportingInfo, '$.MIGRATED') is null
								and json_Value(ppt.SupportingInfo, '$.MIGRATED') = 1 then 0
							when json_Value(p2.SupportingInfo, '$.MIGRATED') is null
								and json_Value(ppt.SupportingInfo, '$.MIGRATED') is null
								and p2.EnteredDateTime &lt; ppt.EnteredDateTime  then 1
							else 0
						end
				and ppt.StatementAmt &gt; 0
				and ppt.TransType = 4
				--there were a couple of statements that we had to do a full reverse payable to 
				--revert an incorrect statement and if that reversal was positive it was incorrectly
				--marking previous DUEs as cleared
				and ppt.RecType in('DUE', 'CPBL') 
				and ppt.[Last RecType] &lt;&gt; 'REVPBL') dc

--JKS 1/17/2020 - at the end of July there was an issue with the AFSICommission close process
--where all of the outstanding balances from June were not applied to the July statements
--this caused several hundred agents to receive a payment incorrectly
--a large number of the affected agents still have not received a positive statement, so we 
--need to mark the June balances as still DUE
outer apply (select distinct 1 as PaidInJulyByMistake
				from #PayablesPreparedTypes p (nolock)
				where p2.ParentID = p.ParentID
				and p2.StatementDate = '6/30/2019'
				and p2.RecType = 'DUE'
				and p.StatementDate = '7/31/2019'
				and p.RecType = 'CPBL') c
outer apply (select distinct 1 as ValidClearAfterJuly
				from #PayablesPreparedTypes p (nolock)
				where p2.ParentID = p.ParentID
				and p.StatementDate &gt; '7/31/2019'
				and p.RecType in( 'CPBL', 'DUE')
				and p.StatementAmt &gt; 0) f

where p2.[Last RecType] &lt;&gt; 'REVPBL'



CREATE NONCLUSTERED INDEX [IX_PayablesPreparedTypes_OrigPayableID] ON #PayablesPreParedTypes 

		( PayableID ASC )

		INCLUDE

		( PayableStatus )

		WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF , SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF , ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

		ON [PRIMARY];



--select *
--from #PayablesPreparedTypes p2
--outer apply (select *
--				from #PayablesPreparedTypes ppt 
--				where p2.ParentID = ppt.ParentID
--				and p2.ParentType = ppt.ParentType
--				and p2.RecType = 'DUE'
--				and 1 = case
--							when json_Value(p2.SupportingInfo, '$.MIGRATED') = 1
--								AND ppt.StatementDate &gt; p2.StatementDate then 1
--							when json_Value(p2.SupportingInfo, '$.MIGRATED') is null
--								and json_Value(ppt.SupportingInfo, '$.MIGRATED') = 1 then 0
--							when json_Value(p2.SupportingInfo, '$.MIGRATED') is null
--								and json_Value(ppt.SupportingInfo, '$.MIGRATED') is null
--								and p2.EnteredDateTime &lt; ppt.EnteredDateTime  then 1
--							else 0
--						end
				
--				and ppt.StatementAmt &gt; 0
--				and ppt.TransType = 4
--				and ppt.[Last RecType] &lt;&gt; 'REVPBL') dc
--where p2.payableid = 1348588

--select *
--from #PayablesPreparedTypes ppt 
--where ppt.PayableStatus = 'Cleared'

--INNER JOIN Accounting.dbo.Payables p2 (nolock) 
--	on a.PayableID = p2.PayableID
--	--JKS 1/15/2020 - we had an incident in 2019 where the Credit Balance Payments were not applied correctly so we needed to
--	--trash the statements and put all of the details onto the next month, those trashed statements need to be excluded from
--	--the aging process


 --outer apply (

	--							-------NEW-----------------------------



	--							select distinct 1 as DueCleared

	--							FROM Accounting.dbo.Payables p (nolock)

	--							INNER JOIN #DueClearedPrepared p3
									
	--								ON isnull(p.OrigPayableID, p.PayableID) = p3.

	--							where a.ParentID = p3.ParentID

	--							and a.ParentType = p3.ParentType							

	--							and p3.EnteredDateTime &gt; a.EnteredDateTime

	--							and a.RecType in('DUE')

	--					     ) ds --commented for testing

	
--	select * from #PayablesPrePared where ParentID = 1210 order by payableid

--	select *
--from dbo.Payables p (nolock)
--where p.ParentID = 1210
--and p.StatementDate &gt;= '6/30/2019'
--order by p.payableid


--select *
--from dbo.Payables p (nolock)
--where OrigPayableID is null






	
	

	--select p.*, 

	--				case

	--					--adding a handler of Write Offs that doesn't rely on ORIGPAYABLEID existing in SupportingInfo until we can get a backfill and update the process to always insert that

	--					when p.RecType = 'WROFF' then 'Written Off'

	--					when s.PayableStatus is null then 'Unknown'

	--					else s.PayableStatus

	--				end as PayableStatus,

	--				ds.DueCleared

	--				into #PayablesPreparedFinal

	--			from Accounting.dbo.Payables p (nolock)

	--			--to get the status of whether a given amount has actually been paid we need to find the latest roll-up record

	--			--the type of the latest record tells us whether the money is still on the Agent's account or has been sent out

	--			outer apply (

				           

	--					   -----------------NEW---------------------------------------------

	--					   SELECT  PayableStatus

	--					   FROM #PayablesPrepared p2

	--					   WHERE

	--					    p.ParentID = p2.ParentID

	--						and p.ParentType = p2.ParentType						

	--						--and cast(p.PayableID as varchar(30)) = p2.SupportingInfo
	--						and p.PayableID = p2.OrigPayableID



	--						) s

	--			--if the original Payable was a DUE amount we need to check to see if there's been any positive activity

	--			--on the agent after the DUE amount was incurred,

	--			--the only way for an agent to have a positive TransType 4 is their statement's activity has to take them above

	--			--the threshold, once a DUE amount has been cleared it's no longer outstanding

				

			     

	--			where-- ac.PayableID = p.PayableID

	--			 cast(p.EnteredDateTime as date) &lt;= @EOMDate

	--			 and p.TransType in(4, 11)

				



--Declare @EOMDate datetime = '12/31/2019'




create table #AFSICommissionLoaded(SourceGrpID int, MasterAgtID int, AgtID int, PolicyID int, LOB varchar(10), Descr varchar(100), RecType varchar(10),
								PaidPrem decimal(18,2), PaidTax decimal(18,2), PaidFee decimal(18,2), CommAmt decimal(18,2),
								StatementDate datetime, Migrated bit, ComsnCalcBasis varchar(5), PayableID int NULL, PayableStatus varchar(50) NULL)


		CREATE NONCLUSTERED INDEX [IX_AFSICommissionLoaded_Lookup] ON #AFSICommissionLoaded 

		( 
		SourceGrpID ASC,
		MasterAgtID ASC,
		AgtID ASC,
		PolicyID ASC,
		LOB ASC )

		INCLUDE(RecType, Descr, PaidPrem, PaidTax, PaidFee, CommAmt, StatementDate, Migrated, ComsnCalcBasis, PayableID, PayableStatus)

		WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF , SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF , ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

		ON [PRIMARY];


--Declare @EOMDate datetime = '12/31/2019'

insert into #AFSICommissionLoaded(SourceGrpID, MasterAgtID, AgtID, PolicyID, LOB, Descr, RecType,
								PaidPrem, PaidTax, PaidFee, CommAmt,
								StatementDate, Migrated, ComsnCalcBasis, PayableID)

select isnull(ac.SourceGrpID, 11) as SourceGrpID,

ac.MasterAgtID,

ac.AgtID, 

ac.PolicyID, 

ac.LOB, 

ac.Descr,

ac.RecType,

isnull(ac.PaidPrem, 0) as PaidPrem,

isnull(ac.PaidTax, 0) as PaidTax,

isnull(ac.PaidFee, 0) as PaidFee,

isnull(ac.CommAmt, 0) as CommAmt,

ac.StatementDate,

ac.Migrated,

ac.ComsnCalcBasis,

ac.PayableID

from Accounting.dbo.AFSICommission ac (nolock)

where ac.SourceGrpID = 1
and ac.TransType = 9
and cast(ac.EnteredDateTime as date) &lt;= @EOMDate



update ac set

ac.PayableStatus = ppt.PayableStatus

from #AFSICommissionLoaded ac
left join #PayablesPreparedTypes ppt
	on ac.PayableID = ppt.PayableID 



--select 

--ac.MasterAgtID,

--ac.AgtID, 

--ac.PolicyID, 

--ac.LOB, 

--l.DateEffective, 

--l.DateCanc, 

--l.DateAudit,

--isnull(l.CurrentPolicyCost, 0) as LastActivityPolicyCost,

--isnull(l.BilledPremAmt, 0) as LastActivityBilledPremium,

--isnull(l.BilledTaxAmt, 0) as LastActivityBilledTax,

--isnull(l.BilledFeeAmt, 0) as LastActivityBilledFee,

--l.ComsnCalcBasis as LastActivityComCalcBasis,

--l.BillType as LastActivityBillType,

--l.ComRate as LastActivityComRate,

--sum(isnull(ac.PaidPrem, 0)) as TotalAllocatedPremium,

--sum(isnull(ac.PaidTax, 0)) as TotalAllocatedTax,

--sum(isnull(ac.PaidFee, 0)) as TotalAllocatedFees,


--sum(isnull(ac.CommAmt, 0)) as TotalAllocatedCommission,

--sum(case

--			--if a given detail has not been processed to be included in a Payable then it is considered Unprocessed

--			--this can happen for a couple of reasons

--			--1. the net value of all the details for an agent is below the threshold to create a statement (June and Nov close is $5, all others is $50)

--			--2. a policy is actively in Collections so even though we calculated commission on their AR activity we don't pay the commission 

--			--		unless the policy is removed from Collections

--			--3. all of the activity of a policy nets to $0, example WC PolicyID: 1748763, has 4 records, 2 payments and 2 NSF reversing those payments

--			--4. Agency Bill payments, we have a record in AFSICommission to keep track of the kept commission so in the event the policy switches to Direct Bill

--			--		we have a single place to sum up all commission allocated to the policy

--			--JKS 11/13/2019 - switched from checking if the Payable Status is NULL to seeing whether the field is filled in at all
--			when pr.PayableStatus is null 

--				and ac.StatementDate &lt;= @EOMDate 

--				--exclude the cut-over records containing the prior paid/kept

--				and ac.Migrated = 0 

--				--exclude allocated Agency Bill details, those show in the Agency Bill bucket

--				and ac.ComsnCalcBasis &lt;&gt; 'AB' then isnull(ac.CommAmt, 0)



--			else 0



--		end) as UnprocessedAmount,



--	sum(case

--			--Details that have been processed and the last activity for the Payable it's included on is clearing the amount from the Agent's balance it's considered Paid

--			when pr.PayableStatus in('Paid', 'Cleared') then isnull(ac.CommAmt, 0)

			

--			--Details that were originally on a statement requiring an amount back from the agent that have subsequently received a positive statement (we owe them)

--			--	should be considered paid and the amounts included in the total Direct Bill Paid

--			--	this would be similar to when in the old process an Unearned (aka returned commission) is applied 

--			--changed the process to determine whether the dues were cleared to above and made the Status Cleared
--			--when pr.PayableStatus = 'DUE'

--			--	and isnull(pr.DueCleared, 0) = 1 then isnull(ac.CommAmt, 0)


			
--			--Migrated totals from old process

--			when pr.PayableStatus is null

--				and ac.Migrated = 1

--				and ac.RecType = 'OTHER'

--				and ac.Descr = 'Total PaidCom' then isnull(ac.CommAmt, 0)



--			else 0



--		end) as DirectBillCommissionPaid,



--	sum(case

--			--none of the Agency Bill details should have a Payable, will add a validator later that the Kept Commission here matches AcctRec

--			--Include the migrated Total Kept Commission

--			when pr.PayableStatus is null

--				and ac.Migrated = 1

--				and ac.RecType = 'OTHER'

--				and ac.Descr = 'Total CommKept' then isnull(ac.CommAmt, 0)



--			--all Agency Bill payments made since Cutover have their own AB records that are excluded from Direct Bill Statements

--			when pr.PayableStatus is null

--				and ac.ComsnCalcBasis = 'AB' then isnull(ac.CommAmt, 0)



--			else 0



--		end) as AgencyBillKept,




--	sum(case

--					--Details on a statement where the Payable has not been cleared ar Outstanding, most month's this will include the items getting paid by ACH

--					--	because the ACH batch gets processed and sent to the bank the week following close. When it gets sent to the bank is when the EPMT records are inserted 

--					--	to offset/clear the Payable

--					when pr.PayableStatus = 'Outstanding' then isnull(ac.CommAmt, 0)



--					--Details on a statement with an amount due back from the agent that hasn't been cleared are still Outstanding

--					when pr.PayableStatus = 'DUE'

--						--and isnull(pr.DueCleared, 0) = 0 
--						then isnull(ac.CommAmt, 0)


--					else 0



--				end) as OutstandingDirectBillCommission,



--	sum(case

--			--The new AFSI Commission process has incorporated the ability for the business to Write Off items that they don't want to continue asking back from the agent

--			--	or amounts that should not be paid, most times these are small values (typically less than $1) to reduce clutter on the statements, can also be activity from a really old policy

--			when pr.PayableStatus = 'Written Off' then isnull(ac.CommAmt, 0)



--			else 0



--		end) as WrittenOffCommission,


--	sum(case

--			--The new AFSI Commission process has incorporated the ability for the business to Write Off items that they don't want to continue asking back from the agent

--			--	or amounts that should not be paid, most times these are small values (typically less than $1) to reduce clutter on the statements, can also be activity from a really old policy

--			when pr.PayableStatus = 'Waiting to Reissue' then isnull(ac.CommAmt, 0)



--			else 0



--		end) as [Waiting to Reissue Commission],



--	sum(case

--			--if the detail is for a payment taken on a policy who's effective date is in a following month that amount needs to show in the Future Due, not Unprocessed

--			when pr.PayableStatus is null

--				and ac.StatementDate &gt; @EOMDate 

--				--exclude the cut-over records containing the prior paid/kept

--				and ac.Migrated = 0 then isnull(ac.CommAmt, 0)



--			else 0



--		end) as FutureAllocated



--into #LastActivity

----declare @EOMDate DATE = '6/30/2019'

----select pr.*, ac.* 

--from #AFSICommissionLoaded ac (nolock)



----get the latest record included in or before the reporting month

----this will get us the last values for things like Policy Cost and Billed Amounts

--cross apply (

--				---------------NEW----------------------------

--				select top 1 * from #AFSICommissionPrepared ac2

--				WHERE 1 = 1

--				--ac.SourceGrpID = ac2.SourceGrpID

--				and ac.PolicyID = ac2.PolicyID

--				and ac.LOB = ac2.LOB

--				--added Agent info to the join for situations where the agent (or Master Agent) changes and the old agent owes

--				and ac.MasterAgtID = ac2.MasterAgtID

--				and ac.AgtID = ac2.AgtID

--				--and cast(ac2.EnteredDateTime as date) &lt;= @EOMDate

--				and ac.StatementDate &lt;= @EOMDate				

				

--				) l



----need to see whether a given detail has been processed (included on a Statement/Write Off)

--outer apply (		select p.*

--					FROM #PayablesPreparedTypes p
--					--JKS - switch to SupportingInfo
--					where ac.PayableID = p.OrigPayableID

--				) pr



--where ac.SourceGrpID = 1 --Source Group 1 = AFSI (WC and CPP), Source Group 4 = Assigned Risk

----and cast(ac.EnteredDateTime as date) &lt;= @EOMDate

----need to limit the detail pull to JUST TransType 9 because Bonus Commissions have a TransType of 14 and the dedicated Deferred Commission Records use 13

----and ac.TransType = 9


----and ac.PolicyID = 1830090

----and ac.LOB = 'WC'



--group by

--ac.MasterAgtID, 

--ac.AgtID, 

--ac.PolicyID, 

--ac.LOB, 

--l.DateEffective, 

--l.DateCanc, 

--l.DateAudit,

--isnull(l.CurrentPolicyCost, 0),

--isnull(l.BilledPremAmt, 0),

--isnull(l.BilledTaxAmt, 0),

--isnull(l.BilledFeeAmt, 0),

--l.ComsnCalcBasis,

--l.BillType,

--l.ComRate

--option (maxdop 16);


--Declare @EOMDate datetime = '12/31/2019'

select 

ac.MasterAgtID,

ac.AgtID, 

ac.PolicyID, 

ac.LOB, 

l.DateEffective, 

l.DateCanc, 

l.DateAudit,

isnull(l.CurrentPolicyCost, 0) as LastActivityPolicyCost,

isnull(l.BilledPremAmt, 0) as LastActivityBilledPremium,

isnull(l.BilledTaxAmt, 0) as LastActivityBilledTax,

isnull(l.BilledFeeAmt, 0) as LastActivityBilledFee,

l.ComsnCalcBasis as LastActivityComCalcBasis,

l.BillType as LastActivityBillType,

l.ComRate as LastActivityComRate,

sum(isnull(ac.PaidPrem, 0)) as TotalAllocatedPremium,

sum(isnull(ac.PaidTax, 0)) as TotalAllocatedTax,

sum(isnull(ac.PaidFee, 0)) as TotalAllocatedFees,


sum(isnull(ac.CommAmt, 0)) as TotalAllocatedCommission,

sum(case

			--if a given detail has not been processed to be included in a Payable then it is considered Unprocessed

			--this can happen for a couple of reasons

			--1. the net value of all the details for an agent is below the threshold to create a statement (June and Nov close is $5, all others is $50)

			--2. a policy is actively in Collections so even though we calculated commission on their AR activity we don't pay the commission 

			--		unless the policy is removed from Collections

			--3. all of the activity of a policy nets to $0, example WC PolicyID: 1748763, has 4 records, 2 payments and 2 NSF reversing those payments

			--4. Agency Bill payments, we have a record in AFSICommission to keep track of the kept commission so in the event the policy switches to Direct Bill

			--		we have a single place to sum up all commission allocated to the policy

			--JKS 11/13/2019 - switched from checking if the Payable Status is NULL to seeing whether the field is filled in at all
			when ac.PayableStatus is null 

				and ac.StatementDate &lt;= @EOMDate 

				--exclude the cut-over records containing the prior paid/kept

				and ac.Migrated = 0 

				--exclude allocated Agency Bill details, those show in the Agency Bill bucket

				and ac.ComsnCalcBasis &lt;&gt; 'AB' then isnull(ac.CommAmt, 0)



			else 0



		end) as UnprocessedAmount,



	sum(case

			--Details that have been processed and the last activity for the Payable it's included on is clearing the amount from the Agent's balance it's considered Paid

			when ac.PayableStatus in('Paid', 'Cleared') then isnull(ac.CommAmt, 0)

			

			--Details that were originally on a statement requiring an amount back from the agent that have subsequently received a positive statement (we owe them)

			--	should be considered paid and the amounts included in the total Direct Bill Paid

			--	this would be similar to when in the old process an Unearned (aka returned commission) is applied 

			--changed the process to determine whether the dues were cleared to above and made the Status Cleared
			--when ac.PayableStatus = 'DUE'

			--	and isnull(ac.DueCleared, 0) = 1 then isnull(ac.CommAmt, 0)


			
			--Migrated totals from old process

			when ac.PayableStatus is null

				and ac.Migrated = 1

				and ac.RecType = 'OTHER'

				and ac.Descr = 'Total PaidCom' then isnull(ac.CommAmt, 0)



			else 0



		end) as DirectBillCommissionPaid,



	sum(case

			--none of the Agency Bill details should have a Payable, will add a validator later that the Kept Commission here matches AcctRec

			--Include the migrated Total Kept Commission

			when ac.PayableStatus is null

				and ac.Migrated = 1

				and ac.RecType = 'OTHER'

				and ac.Descr = 'Total CommKept' then isnull(ac.CommAmt, 0)



			--all Agency Bill payments made since Cutover have their own AB records that are excluded from Direct Bill Statements

			when ac.PayableStatus is null

				and ac.ComsnCalcBasis = 'AB' then isnull(ac.CommAmt, 0)



			else 0



		end) as AgencyBillKept,




	sum(case

					--Details on a statement where the Payable has not been cleared ar Outstanding, most month's this will include the items getting paid by ACH

					--	because the ACH batch gets processed and sent to the bank the week following close. When it gets sent to the bank is when the EPMT records are inserted 

					--	to offset/clear the Payable

					when ac.PayableStatus = 'Outstanding' then isnull(ac.CommAmt, 0)



					--Details on a statement with an amount due back from the agent that hasn't been cleared are still Outstanding

					when ac.PayableStatus = 'DUE'

						--and isnull(ac.DueCleared, 0) = 0 
						then isnull(ac.CommAmt, 0)


					else 0



				end) as OutstandingDirectBillCommission,



	sum(case

			--The new AFSI Commission process has incorporated the ability for the business to Write Off items that they don't want to continue asking back from the agent

			--	or amounts that should not be paid, most times these are small values (typically less than $1) to reduce clutter on the statements, can also be activity from a really old policy

			when ac.PayableStatus = 'Written Off' then isnull(ac.CommAmt, 0)



			else 0



		end) as WrittenOffCommission,


	sum(case

			--The new AFSI Commission process has incorporated the ability for the business to Write Off items that they don't want to continue asking back from the agent

			--	or amounts that should not be paid, most times these are small values (typically less than $1) to reduce clutter on the statements, can also be activity from a really old policy

			when ac.PayableStatus = 'Waiting to Reissue' then isnull(ac.CommAmt, 0)



			else 0



		end) as [Waiting to Reissue Commission],



	sum(case

			--if the detail is for a payment taken on a policy who's effective date is in a following month that amount needs to show in the Future Due, not Unprocessed

			when ac.PayableStatus is null

				and ac.StatementDate &gt; @EOMDate 

				--exclude the cut-over records containing the prior paid/kept

				and ac.Migrated = 0 then isnull(ac.CommAmt, 0)



			else 0



		end) as FutureAllocated



into #LastActivity

--declare @EOMDate DATE = '6/30/2019'

--select pr.*, ac.* 

from #AFSICommissionLoaded ac (nolock)



--get the latest record included in or before the reporting month

--this will get us the last values for things like Policy Cost and Billed Amounts

cross apply (

				---------------NEW----------------------------

				select top 1 * from #AFSICommissionPrepared ac2

				WHERE 1 = 1

				--ac.SourceGrpID = ac2.SourceGrpID

				and ac.PolicyID = ac2.PolicyID

				and ac.LOB = ac2.LOB

				--added Agent info to the join for situations where the agent (or Master Agent) changes and the old agent owes

				and ac.MasterAgtID = ac2.MasterAgtID

				and ac.AgtID = ac2.AgtID

				--and cast(ac2.EnteredDateTime as date) &lt;= @EOMDate

				--and ac.StatementDate &lt;= @EOMDate				

				

				) l





where ac.SourceGrpID = 1 --Source Group 1 = AFSI (WC and CPP), Source Group 4 = Assigned Risk

--and cast(ac.EnteredDateTime as date) &lt;= @EOMDate

--need to limit the detail pull to JUST TransType 9 because Bonus Commissions have a TransType of 14 and the dedicated Deferred Commission Records use 13

--and ac.TransType = 9


--and ac.PolicyID = 1830090

--and ac.LOB = 'WC'



group by

ac.MasterAgtID, 

ac.AgtID, 

ac.PolicyID, 

ac.LOB, 

l.DateEffective, 

l.DateCanc, 

l.DateAudit,

isnull(l.CurrentPolicyCost, 0),

isnull(l.BilledPremAmt, 0),

isnull(l.BilledTaxAmt, 0),

isnull(l.BilledFeeAmt, 0),

l.ComsnCalcBasis,

l.BillType,

l.ComRate

option (maxdop 16);


--select *
--from #LastActivity la 
--where la.PolicyID = 1830090


--select *
--from #PayablesPreparedFinal pp
--where pp.ParentID = 1210
--and pp.StatementDate &gt;= '6/30/2019'



DROP TABLE IF EXISTS #AFSICommissionPreparedInitial;

DROP TABLE IF EXISTS #AFSICommissionPrepared;

DROP TABLE IF EXISTS #PayablesPrepared;

DROP TABLE IF EXISTS #DueClearedPrepared;

DROP TABLE IF EXISTS #PayablesPreparedFinal;


drop table if exists #AFSICommissionLoaded;

drop table if exists #PayablesPreparedTypes;



/* --validate that all of the allocation values for each policy balance

select *

from #LastActivity l

where l.TotalAllocatedCommission &lt;&gt; (l.UnprocessedAmount + 

										l.AgencyBillKept + 

										l.DirectBillCommissionPaid + 

										l.OutstandingDirectBillCommission + 

										l.WrittenOffCommission + 

										l.FutureAllocated)



select l.PolicyID, l.LOB, count(*) as cnt

from #LastActivity l

group by l.PolicyID, l.LOB

having count(*) &gt; 1



*/



---///////////////////////////////////GET WC POLICY INFORMATION///////////////////////////////////////////////////////////////////

/*Long Execution Point*/ 

/***Query takes more than 22hours without completion****/

--Declare @EOMDate datetime = '12/31/2019'

SELECT 

min(BasisID) as BasisID,

ChildID,

CAST(NULL as varchar(255)) as ComCalcBasis 

into #RefComCalcBasisLookupPrepared

FROM 

Accounting.dbo._RefComCalcBasisLookup cbl (nolock)

where  cbl.ChildType = 2 --Policy

	and cbl.SourceID = 5 --WC

GROUP BY ChildID



UPDATE a

set a.ComCalcBasis = cbl.ComCalcBasis

FROM #RefComCalcBasisLookupPrepared a LEFT JOIN Accounting.dbo._RefComCalcBasisLookup cbl (nolock)

on a.BasisID = cbl.BasisID





SELECT 

ChildID,

ComCalcBasis

into #currentComCalcBasisPrepared

from Accounting.dbo._RefComCalcBasisLookup cbl2 (nolock)

where

cbl2.ChildType = 2 --Policy

and cbl2.SourceID = 5 --WC

and 1 = case

			--make sure the current active basis was entered before the selected date

			when cbl2.ChangeDateTime is null

				and cast(cbl2.EnteredDateTime as date) &lt;= @EOMDate then 1

	

			--find which basis was active for the selected date

			when cbl2.ChangeDateTime is not null

				and cast(cbl2.EnteredDateTime as date) &lt;= @EOMDate

				and cast(cbl2.ChangeDateTime as date) &gt; @EOMDate then 1

			else 0

		end







--declare @EOMDate DATE = '12/31/2019', @PrevEOMDate DATE = NULL	

		SELECT pd.PolicyID ,

			   CAST(GETDATE() AS DATE) AS ReportDate ,

			   pd.FirmID ,

			   pd.UwOfc ,

			   pd.AgtId ,

			   agt.AgtName ,

			   pd.AgtGroup ,

			   pd.AgtBoundDate AS DateBound ,

			   'WC' AS LOB ,

			   pd.Policy ,

			   ins.InsName ,

			   pd.DateEffective ,

			   pd.DateAudit ,

			   pd.DateCanc ,

			   col.[Collections Start Date] ,

			   pd.BillType ,

			   pd.ComRate1 ,

			   CASE WHEN pd.SystemEnteredBy LIKE '%bang%' THEN 1

					WHEN pd.SystemEnteredBy LIKE '%import%' THEN 1

					ELSE 0

			   END AS [Migrated Policy] ,

			   pd.NoRefund ,

			   pd.StopInvoice ,

			   pd.StopAuditInvoice ,

			   --Getting the first ComCalcBasis from the lookup table

			   oc.ComCalcBasis AS [Original ComCalcBasis] ,

			   --Get the current ComCalcBasis as of the Report Date

			   cc.ComCalcBasis,

			   CASE WHEN pd.PmtPlan = 2 THEN 'PAYO'

					WHEN pd.PmtPlan = 3 THEN 'PSR - PAYO Self Reporting'

					WHEN pd.PmtPlan = 4 THEN 'MSA - Monthly Self Audit'

					ELSE 'Regular'

			   END AS PaymentPlan ,

			   CAST(0 AS BIT) AS DoNotUse

			  ,NumPmts [NumPayments] --DK

		INTO   #WCPolicies

		FROM Premdat.dbo.PolicyData pd (nolock)



		CROSS APPLY (SELECT a.AgtName

						FROM   Premdat.dbo.Agents a (nolock)

						WHERE  pd.agtid = a.agtid ) agt 



		CROSS APPLY (SELECT i.InsName

						FROM   premdat.dbo.Insureds i (nolock)

						WHERE  pd.InsID = i.InsID ) ins



       --find the original basis for the policy (initial record gets entered when the policy is bound so we have future policies)

		cross apply (

						SELECT cbl.ComCalcBasis FROM #RefComCalcBasisLookupPrepared cbl

							where pd.PolicyID = cbl.ChildID

					

						) oc



		--get the current basis

		cross apply (

					SELECT cbl2.ComCalcBasis 

					from #currentComCalcBasisPrepared cbl2

					where pd.PolicyID = cbl2.ChildID

						) cc



		OUTER APPLY (	SELECT MIN(c.FirstCollectionDate) AS [Collections Start Date]

						FROM #firstColStartDates c

						WHERE  c.PolicyId = pd.PolicyID

						and c.LOB = 'WC') col



		WHERE  pd.AgtId &lt;&gt; 47 --exclude test policies

		AND pd.FirmID &lt;&gt; 75 --exclude Assigned Risk

		--and pd.Policyid = 2597416 ---'WWC3304180' -- for debug

		--and pd.EOMDate = @EOMDate

		option (maxdop 16);



DROP TABLE IF EXISTS #RefComCalcBasisLookupPrepared;

DROP TABLE IF EXISTS #currentComCalcBasisPrepared;

---///////////////////////////////////GET WC POLICY INFORMATION///////////////////////////////////////////////////////////////////





---///////////////////////////////////GET CPP POLICY INFORMATION//////////////////////////////////////////////////////////////////



		



		SELECT   MAX(sd.EndmtNum) AS EndmtNum ,

				 sd.PolicyId

		INTO     #MaxEndmtNumHistory

		FROM     CPP.dbo.CPPPolicySubData sd (nolock)

		CROSS APPLY (SELECT eha.EndmtNum

						FROM   CPP.dbo.CPPPolicyEndmtHistory eha (nolock)

						WHERE  sd.PolicyId = eha.PolicyID

						AND sd.EndmtNum = eha.EndmtNum

						AND CAST(eha.DateProcessed AS DATE) &lt;= @EOMDate ) eh

		GROUP BY sd.PolicyId;





		SELECT sd.PolicyID ,

			   sd.DateEffective ,

			   sd.ComRate ,

			   sd.PmtPlan ,

			   e.AuditDate ,

			   sd.DateCanc

		INTO   #PolicySubDataPrepared

		FROM   CPP.dbo.CPPPolicySubData sd (nolock)

		INNER JOIN #MaxEndmtNumHistory mh 

			ON mh.PolicyID = sd.PolicyID

			AND mh.EndmtNum = sd.EndmtNum

		CROSS APPLY (SELECT TOP 1 eh.AuditDate
						
						FROM CPP.dbo.CPPPolicyEndmtHistory eh (nolock)
						
						WHERE sd.PolicyID = eh.PolicyID

						ORDER BY eh.EndmtNum DESC) e

		;





		CREATE NONCLUSTERED INDEX [IX_MaxEndmtNumHistory_PolicyID] ON #PolicySubDataPrepared 

		( [PolicyID] ASC )

		WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF , SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF , ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

		ON [PRIMARY];


--Declare @EOMDate datetime = '12/31/2019'
			



SELECT 

min(BasisID) as BasisID,

ChildID,

CAST(NULL as varchar(255)) as ComCalcBasis 

into #RefComCalcBasisLookupPreparedCPP

FROM 

Accounting.dbo._RefComCalcBasisLookup cbl (nolock)

where  cbl.ChildType = 2 --Policy

	and cbl.SourceID = 6 --CPP

GROUP BY ChildID



UPDATE a

set a.ComCalcBasis = cbl.ComCalcBasis

FROM #RefComCalcBasisLookupPreparedCPP a LEFT JOIN Accounting.dbo._RefComCalcBasisLookup cbl (nolock)

on a.BasisID = cbl.BasisID



SELECT 

ComCalcBasis,

ChildID

into #calcComBasisCPPCurrentPrepared

FROM 

Accounting.dbo._RefComCalcBasisLookup cbl2 (nolock)

where

cbl2.ChildType = 2 --Policy

and cbl2.SourceID = 6 --CPP

and 1 = case

			--make sure the current active basis was entered before the selected date

			when cbl2.ChangeDateTime is null

				and cast(cbl2.EnteredDateTime as date) &lt;= @EOMDate then 1

	

			--find which basis was active for the selected date

			when cbl2.ChangeDateTime is not null

				and cast(cbl2.EnteredDateTime as date) &lt;= @EOMDate

				and cast(cbl2.ChangeDateTime as date) &gt; @EOMDate then 1

			else 0

		end

	

		SELECT pd.PolicyID ,

			   CAST(GETDATE() AS DATE) AS ReportDate ,

			   p.FirmID ,

			   agt.UwOfc ,

			   p.AgtId ,

			   agt.AgtName ,

			   p.AgtGroup ,

			   cq.DateBound ,

			   'CPP' AS LOB ,

			   p.Policy + '-' + p.PolicySuffix AS Policy ,

			   ins.InsName ,

			   p.DateEffective ,

			   pd.AuditDate ,

			   pd.DateCanc ,

			   col.[Collections Start Date] ,

			   pp.BillType ,

			   pd.ComRate AS ComRate1 ,

			   --8/23/2018 - Per Michael Taylor CPP has not done any Big Bang migrations, acquisition policies are renewed into the system

			   0 AS [Migrated Policy] ,

			   p.NoRefund ,

			   p.DoNotInvoice ,

			   p.DoNotInvoiceAfterAudit ,

			   oc.ComCalcBasis AS [Original ComCalcBasis] ,

			   cc.ComCalcBasis,

			   CAST(pp.PPID AS VARCHAR(20)) AS PaymentPlan ,

			   CAST(0 AS BIT) AS DoNotUse

			  ,NumPayments [NumPayments] --DK

		INTO   #CPPPolicies



		FROM   CPP.dbo.CPPPolicyCore p (nolock)

		CROSS APPLY (   SELECT sd.PolicyID ,

									  sd.DateEffective ,

									  sd.ComRate ,

									  sd.PmtPlan ,

									  sd.AuditDate ,

									  sd.DateCanc

						FROM   #PolicySubDataPrepared sd (nolock)

						WHERE  p.policyid = sd.policyid ) pd



		OUTER APPLY (   SELECT cqa.DateBound

						FROM   CPP.dbo.CPPQuote cqa ( NOLOCK )

						WHERE  p.quotenum = cqa.quotenum ) cq



		LEFT JOIN CPP.dbo.PaymentPlans pp (nolock)

			ON pd.PmtPlan = pp.PPID 

	

		CROSS APPLY (   SELECT a.AgtName , ag.UwOfc

						FROM   Premdat.dbo.Agents a (nolock)

						INNER JOIN Premdat.dbo.AgtGroup ag (nolock)

							ON a.AgtGroup = ag.AgtGroup

						WHERE  p.agtid = a.agtid ) agt 

		

		OUTER APPLY (   SELECT i.InsName

						FROM   CPP.dbo.InsuredsSubData_View i (nolock)

						WHERE  p.InsID = i.InsID ) ins



		--find the original basis for the policy (initial record gets entered when the policy is bound so we have future policies)

		cross apply (

						SELECT ComCalcBasis from #RefComCalcBasisLookupPreparedCPP cbl

						where p.PolicyID = cbl.ChildID					

						) oc

		

		--get the current basis

		cross apply (	

						SELECT ComCalcBasis

						from #calcComBasisCPPCurrentPrepared cbl2

						where p.PolicyID = cbl2.ChildID						

						) cc





		OUTER APPLY (SELECT MIN(c.FirstCollectionDate) AS [Collections Start Date]

						FROM #firstColStartDates c

						WHERE  c.PolicyId = pd.PolicyID

						and c.LOB = 'CPP') col



		WHERE  p.AgtID &lt;&gt; 47 --exclude test policies

		--and p.Policy = 'WWC3304180' -- for debug

		option (maxdop 16);



DROP TABLE IF EXISTS #RefComCalcBasisLookupPreparedCPP;

DROP TABLE IF EXISTS #calcComBasisCPPCurrentPrepared;

---///////////////////////////////////GET CPP POLICY INFORMATION//////////////////////////////////////////////////////////////////





---///////////////////////////////////COMBINE POLICY RECORDS AND UPDATE DONOTUSE//////////////////////////////////////////////////

		select isnull(ams.MasterAgtID, t.AgtID) as MasterAgtID, t.*

		into #Policies

		from (

			select *

			from #WCPolicies



			union all



			select *

			from #CPPPolicies

			) t
		left join Premdat.dbo.AgtMasterSubs ams (nolock)
			on t.AgtID = ams.SubAgtID
			and ams.DisabledDate is null


		

		UPDATE a SET    

		a.DoNotUse = CASE 

						--when Policy is Agency Bill mark as DoNotUse

						WHEN a.BillType = 'A' THEN CAST(1 AS BIT)

                        

						ELSE

							

							CASE 

								--if the DateEffective is not set then mark as DoNotUse

								WHEN YEAR(a.DateEffective) &lt; 1 THEN CAST(1 AS BIT)

                                

								ELSE

									--if the Policy is Migrated mark as DoNotuse

                                    CASE 

										WHEN [Migrated Policy] = 1 THEN 1

                                        

										ELSE

											--if the Policy is for one of the following Firms mark as DoNotUse

                                            CASE 

												WHEN FirmID IN ( 4, 9, 12, 30, 31, 78, 79, 80, 81) THEN 1

												

                                                --otherwise keep the policy in downstream reports

												ELSE 0



                                            END

                                    END

							END

                    END

		FROM   #Policies a

		option (maxdop 16);



---///////////////////////////////////COMBINE POLICY RECORDS AND UPDATE DONOTUSE//////////////////////////////////////////////////



---///////////////////////////////////GATHER REFERENCE VALUES, NOT FOR CALCULATIONS///////////////////////////////////////////////



--JKS 7/16/2019 - values are for REFERENCE purpose only, these are getting current totals whenever the report is ran

--this is not indicitive of the values used for actual Commission calculation

--POTENTIAL ISSUE, in ANAWC, when a mid-term premium bearing endorsement is processed, the change in cost is applied to all the remaining

--installments. Unfortunately, it also overwrites the EnteredDate with the date of the change. Since we are back to looking at live tables

--if the report is ran anytime after close there is a chance that the values returned will exclude all future items that originally WOULD

--have been included

--JKS 7/26/2019 - update PremInvAmts columns to include the Temp columns if @EOMDate &lt; DateCanc + 30, use nullif Field = 0, then grab the Temp so we don't double count on policies with multiple cancels --DK copied sums from JKS 7/26/19 version

--JKS 7/31/2019 - updated logic to account for a variable to be set when determining whether to include the temp columns or not, also added a check if DateAudit is null since the schedule is SUPPOSED to be fully updated at Audit

--Declare @EOMDate datetime = '12/31/2019', @PrevEOMDate DATE = NULL, @UseDateCancOffset bit = 1 

Select distinct PolicyID, 'WC' [LOB] 

into #cancWCpol 

from Premdat.dbo.PremInvAmts (nolock)

Where PremInvDesc like '%canc%'

option (maxdop 16);





SELECT   

	SUM(case

			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and wp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and wp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp)--DK changed from and DATEADD(d, 30, wp.DateCanc) &lt; @EOMDate



			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and (wp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp)

				

			else pia.PremInvAmt



		end) AS PolicyCost ,

	SUM(case

			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and wp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and wp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp) - isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp) - isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)--DK changed from and DATEADD(d, 30, wp.DateCanc) &lt; @EOMDate



			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and (wp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp) - isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp) - isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)

				

			else pia.PremInvAmt - pia.TaxAmt - pia.FeeAmt



		end ) AS TotalPremium ,

	SUM(case

			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and wp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and wp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp) --DK changed from and DATEADD(d, 30, wp.DateCanc) &lt; @EOMDate



			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and (wp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp)

				

			else pia.TaxAmt



		end) AS TotalTax ,

	SUM(case

			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and wp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and wp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)--DK changed from and DATEADD(d, 30, wp.DateCanc) &lt; @EOMDate



			when wp.DateCanc is not null

				and wp.DateAudit is null

				and @UseDateCancOffset = 1

				and cWC.policyid is null

				and wp.DateCanc &lt;&gt; wp.DateEffective

				and (wp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)

				

			else pia.FeeAmt

			

	end) AS TotalFee ,

	

         --MAX(pia.[PremInvDate]) as MaxInvoiceDate,

         --(   SELECT MAX(pia1.[PremInvDate])

         --    FROM   FinancialSnapshot.dbo.EOM_Premdat_PremInvAmts pia1 (NOLOCK)

         --    WHERE  pia1.PolicyID = wp.PolicyID

         --           AND CAST(pia1.EnteredDate AS DATE) &lt;= @EOMDate

         --           AND pia1.[PremInvDate] &lt;= @EOMDate ) AS MaxInvoiceDate ,

	--JKS - 7/31/2019 - changed logic to use the existing pull for speed's sake

	MAX(case

		when cast(pia.EnteredDate as date) &lt;= @EOMDate

			and pia.PremInvDate &lt;= @EOMDate then pia.PremInvDate

		else '1/1/1950'

	end) as MaxInvoiceDate,

    wp.PolicyID

INTO     #WCPremInvAmts

FROM     #WCPolicies wp 

INNER JOIN Premdat.dbo.PremInvAmts pia (nolock) 

    ON wp.PolicyID = pia.PolicyID

LEFT JOIN #cancWCpol cWC (nolock)

	ON wp.PolicyID = cWC.PolicyID

/* --DK

WHERE CAST(pia.EnteredDate AS DATE) &lt;= @EOMDate

AND (@PrevEOMDate IS NULL

	OR CAST(pia.EnteredDate AS DATE) &gt; @PrevEOMDate )

*/ --DK

GROUP BY wp.PolicyID

option (maxdop 16);



--JKS 7/26/2019 - update PremInvAmts columns to include the Temp columns if @EOMDate &lt; DateCanc + 30, use nullif Field = 0, then grab the Temp so we don't double count on policies with multiple cancels --DK

--JKS 7/31/2019 - updated logic to account for a variable to be set when determining whether to include the temp columns or not, also added a check if DateAudit is null since the schedule is SUPPOSED to be fully updated at Audit


--Declare @EOMDate datetime = '12/31/2019', @PrevEOMDate DATE = NULL, @UseDateCancOffset bit = 1 


Select distinct PolicyID, 'CPP' [LOB] 

into #cancCPPpol 

from CPP.dbo.PremInvAmts (nolock)

Where PremInvDesc like '%canc%'

option (maxdop 16);





SELECT   

	SUM(case

			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and cp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and cp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp)--DK changed from and DATEADD(d, 30, cp.DateCanc) &lt; @EOMDate



			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and (cp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp)

				

			else pia.PremInvAmt



		end) AS PolicyCost ,

	SUM(case

			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and cp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and cp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp) - isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp) - isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)--DK changed from and DATEADD(d, 30, cp.DateCanc) &lt; @EOMDate



			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and (cp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.PremInvAmt, 0), pia.PremInvAmtTemp) - isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp) - isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)

				

			else pia.PremInvAmt - pia.TaxAmt - pia.FeeAmt



		end ) AS TotalPremium ,

	SUM(case

			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and cp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and cp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp) --DK changed from and DATEADD(d, 30, cp.DateCanc) &lt; @EOMDate



			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and (cp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.TaxAmt, 0), pia.TaxAmtTemp)

				

			else pia.TaxAmt



		end) AS TotalTax ,

	SUM(case

			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and cp.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and cp.ComCalcBasis &lt;&gt; 'cp'

				then isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)--DK changed from and DATEADD(d, 30, cp.DateCanc) &lt; @EOMDate



			when cp.DateCanc is not null

				and cp.AuditDate is null

				and @UseDateCancOffset = 1

				and cCPP.policyid is null

				and cp.DateCanc &lt;&gt; cp.DateEffective

				and (cp.DateCanc &gt; @EOMDate) 

				then isnull(nullif(pia.FeeAmt, 0), pia.FeeAmtTemp)

				

			else pia.FeeAmt

			

	end) AS TotalFee ,

        --(SELECT MAX(pia1.[PremInvDate])

        --    FROM   FinancialSnapshot.dbo.EOM_CPP_PremInvAmts pia1 (nolock)

        --    WHERE  pia1.PolicyID = cp.PolicyID

        --    AND CAST(pia1.EnteredDate AS DATE) &lt;= @EOMDate

        --    AND pia1.[PremInvDate] &lt;= @EOMDate

        --    AND (   @PrevEOMDate IS NULL

        --            OR CAST(pia1.EnteredDate AS DATE) &gt; @PrevEOMDate )) AS [MaxInvoiceDate] ,

	MAX(case

			when cast(pia.EnteredDate as date) &lt;= @EOMDate

				and pia.PremInvDate &lt;= @EOMDate then pia.PremInvDate

			else '1/1/1950'

		end) as MaxInvoiceDate,

    cp.PolicyID

INTO     #CPPPremInvAmts

FROM     #CPPPolicies cp 

INNER JOIN CPP.dbo.PremInvAmts pia (nolock)

    ON cp.PolicyID = pia.PolicyID

LEFT JOIN #cancCPPpol cCPP (nolock)

	ON cp.PolicyID = cCPP.PolicyID

/* --DK

WHERE    CAST(pia.EnteredDate AS DATE) &lt;= @EOMDate

AND (   @PrevEOMDate IS NULL

	OR CAST(pia.EnteredDate AS DATE) &gt; @PrevEOMDate )

*/ --DK

GROUP BY cp.PolicyID

option (maxdop 16);



select *

into #PremInvAmts

from (

	select *, 'WC' as LOB

	from #WCPremInvAmts



	union all



	select *, 'CPP' as LOB

	from #CPPPremInvAmts

	) t

option (maxdop 16);



CREATE NONCLUSTERED INDEX [IX_PremInvAmts_PolicyID]

    ON #PremInvAmts ( [PolicyID] ASC, [LOB] ASC )

    INCLUDE (

    [PolicyCost] ,

    [TotalPremium] ,

    [TotalTax] ,

    [TotalFee] ,

    [MaxInvoiceDate] )

    WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF ,

           SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF ,

           ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

    ON [PRIMARY];



SELECT   ar.PolicyID ,

         SUM(ar.PaidPrem) AS TotalPaid ,

         SUM(CASE WHEN ar.TransType &lt;&gt; 9 THEN ar.PaidCom

                  ELSE 0

             END) AS CommKept ,

         SUM(CASE WHEN ar.PayCom = 1 THEN ar.PaidPrem

                  ELSE 0

             END) AS CommissionablePaid ,

         SUM(CASE WHEN ar.TransType IN ( 21, 22, 23, 24, 25, 26, 27, 29 )

                       AND ar.PayCom = 0 THEN ar.PaidPrem

                  ELSE 0

             END) AS BadDebtWriteOffs ,

         SUM(CASE WHEN ar.TransType = 9 THEN ar.PaidPrem

                  ELSE 0

             END) AS EOMComAdj

INTO     #WCAcctRecT

FROM     #WCPolicies wp 

INNER JOIN Premdat.dbo.AcctRec ar (nolock)

    ON wp.policyid = ar.PolicyID

WHERE CAST(ar.EnteredDateTime AS DATE) &lt;= @EOMDate

AND ar.DateRecd &lt;= @EOMDate --DK 

GROUP BY ar.PolicyID

option (maxdop 16);



SELECT   ar.PolicyID ,

         ar.EnteredDateTime ,

		 ar.DateRecd , --DK

         SUM(ar.PaidPrem) AS PaidPrem

INTO     #WCAcctRecTT

FROM     #WCPolicies wp 

INNER JOIN Premdat.dbo.AcctRec ar (nolock)

    ON wp.policyid = ar.PolicyID

WHERE    ar.TransType NOT IN ( 9, 21, 22, 23, 24, 25, 26, 27, 29 )

AND ar.PayCom = 0

AND CAST(ar.EnteredDateTime AS DATE) &lt;= @EOMDate

AND ar.DateRecd &lt;= @EOMDate --DK

GROUP BY ar.PolicyID ,

         ar.EnteredDateTime ,

		 ar.DateRecd --DK

option (maxdop 16);


--Declare @EOMDate datetime = '12/31/2019', @PrevEOMDate DATE = NULL, @UseDateCancOffset bit = 1 


SELECT   cp.PolicyID ,

         SUM(ar.PaidPrem) AS TotalPaid ,

         SUM(CASE WHEN ar.TransType &lt;&gt; 9 THEN ar.PaidCom

                  ELSE 0

             END) AS CommKept ,

         SUM(CASE WHEN ar.PayCom = 1 THEN ar.PaidPrem

                  ELSE 0

             END) AS CommissionablePaid ,

         --need to find out how much has been written off on the policy to reduce the amount of commission expense

         --some of the write offs were entered as PayCom true, need to limit the bad debt to just the remaining amounts because they were already included in CommissionablePaid

         SUM(CASE WHEN ar.TransType IN ( 21, 22, 23, 24, 25, 26, 27, 29 )

                       AND ar.PayCom = 0 THEN ar.PaidPrem

                  ELSE 0

             END) AS BadDebtWriteOffs ,

         SUM(CASE WHEN ar.TransType = 9 THEN ar.PaidPrem

                  ELSE 0

             END) AS EOMComAdj

INTO     #CPPAcctRecT

FROM     #CPPPolicies cp 

INNER JOIN CPP.dbo.AcctRec ar (nolock) 

    ON cp.PolicyID = ar.PolicyID

WHERE    CAST(ar.EnteredDateTime AS DATE) &lt;= @EOMDate

AND ar.DateRecd &lt;= @EOMDate --DK

GROUP BY cp.PolicyID

option (maxdop 16);





SELECT   cp.PolicyID ,

		 ar.EnteredDateTime,

 		 ar.DateRecd , --DK

         SUM(ar.PaidPrem) AS PaidPrem

INTO     #CPPAcctRecTT

FROM     #CPPPolicies cp 

INNER JOIN CPP.dbo.AcctRec ar (nolock) 

    ON cp.PolicyID = ar.PolicyID

WHERE    CAST(ar.EnteredDateTime AS DATE) &lt;= @EOMDate

AND ar.DateRecd &lt;= @EOMDate --DK

AND ar.TransType NOT IN ( 9, 21, 22, 23, 24, 25, 26, 27, 29 )

AND ar.PayCom = 0

GROUP BY cp.PolicyID ,

         ar.EnteredDateTime ,

		 ar.DateRecd --DK

option (maxdop 16);



select *

into #AcctRecT

from (

	select *, 'WC' as LOB

	from #WCAcctRecT



	union all



	select *, 'CPP' as LOB

	from #CPPAcctRecT

	) t





select *

into #AcctRecTT

from (

	select *, 'WC' as LOB

	from #WCAcctRecTT



	union all



	select *, 'CPP' as LOB

	from #CPPAcctRecTT

	) t





CREATE NONCLUSTERED INDEX [IX_AcctRecT_PolicyID]

    ON #AcctRecT ( [PolicyID] ASC, [LOB] ASC )

    INCLUDE (

    TotalPaid ,

    CommKept ,

    CommissionablePaid ,

    BadDebtWriteOffs ,

    EOMComAdj )

    WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF ,

           SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF ,

           ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

    ON [PRIMARY];





CREATE NONCLUSTERED INDEX [IX_AcctRecTT_PolicyID]

    ON #AcctRecTT ( [PolicyID] ASC, [LOB] ASC )

    INCLUDE (

    PaidPrem ,

    EnteredDateTime )

    WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF ,

           SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF ,

           ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

    ON [PRIMARY];





SELECT   MAX(a.DateRecd) AS MaxPremPaidDate ,

         a.[PolicyID]

INTO     #WCMaxPremPaidDate

FROM    #WCPolicies wp  

INNER JOIN [Premdat].[dbo].[AcctRec] a (nolock)

	ON wp.PolicyID = a.PolicyID

WHERE    a.DateRecd &lt;= @EOMDate

AND a.PaidPrem &lt;&gt; 0

AND a.PayCom = 1

AND a.[TransType] &lt;&gt; 9

--and a.PolicyID = 2597416

GROUP BY a.[PolicyID];





SELECT   MAX(a.DateRecd) AS MaxPremPaidDate ,

         a.[PolicyID]

INTO     #CPPMaxPremPaidDate

FROM     [CPP].[dbo].[AcctRec] a (nolock)

WHERE    a.DateRecd &lt;= @EOMDate

AND a.PaidPrem &lt;&gt; 0

AND a.PayCom = 1

AND a.[TransType] &lt;&gt; 9

GROUP BY a.[PolicyID];





select *

into #MaxPremPaidDate

from (

	select *, 'WC' as LOB

	from #WCMaxPremPaidDate



	union all



	select *, 'CPP' as LOB

	from #CPPMaxPremPaidDate

	) t





CREATE NONCLUSTERED INDEX [IX_MaxPremPaidDate]

    ON #MaxPremPaidDate ( [PolicyID] ASC, [LOB] ASC )

    INCLUDE ( MaxPremPaidDate )

    WITH ( PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF ,

           SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF ,

           ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 80 )

    ON [PRIMARY];




SELECT *

INTO #canc

FROM 

(SELECT * FROM #cancWCpol

UNION ALL

SELECT * FROM #cancCPPpol) canc


---///////////////////////////////////GATHER REFERENCE VALUES, NOT FOR CALCULATIONS///////////////////////////////////////////////



---///////////////////////////////////COMMISSION CALCULATIONS/////////////////////////////////////////////////////////////////////

--drop table #PreTotals, #Totals, #Report

--declare @EOMDate DATE = '12/31/2019', @PrevEOMDate DATE = NULL, @UseDateCancOffset bit = 1	

SELECT isnull(pd.MasterAgtID, pdac.MasterAgtID) as MasterAgtID, 	
		isnull(pd.PolicyID, pdac.PolicyID) as PolicyID, 	
		isnull(pd.ReportDate, pdac.ReportDate) as ReportDate, 	
		isnull(pd.FirmID, pdac.FirmID) as FirmID, 	
		isnull(pd.UwOfc, pdac.UwOfc) as UwOfc, 	
		isnull(pd.AgtId, pdac.AgtId) as AgtId, 	
		isnull(pd.AgtName, pdac.AgtName) as AgtName, 	
		isnull(pd.AgtGroup, pdac.AgtGroup) as AgtGroup, 	
		isnull(pd.DateBound, pdac.DateBound) as DateBound, 	
		isnull(pd.LOB, pdac.LOB) as LOB, 	
		isnull(pd.Policy, pdac.Policy) as Policy, 	
		isnull(pd.InsName, pdac.InsName) as InsName, 	
		isnull(pd.DateEffective, pdac.DateEffective) as DateEffective, 	
		isnull(pd.DateAudit, pdac.DateAudit) as DateAudit, 	
		isnull(pd.DateCanc, pdac.DateCanc) as DateCanc, 	
		isnull(pd.[Collections Start Date], pdac.[Collections Start Date]) as [Collections Start Date], 	
		isnull(pd.BillType, pdac.BillType) as BillType, 	
		isnull(pd.ComRate1, pdac.ComRate1) as ComRate1, 	
		isnull(pd.[Migrated Policy], pdac.[Migrated Policy]) as [Migrated Policy], 	
		isnull(pd.NoRefund, pdac.NoRefund) as NoRefund, 	
		isnull(pd.StopInvoice, pdac.StopInvoice) as StopInvoice, 	
		isnull(pd.StopAuditInvoice, pdac.StopAuditInvoice) as StopAuditInvoice, 	
		isnull(pd.[Original ComCalcBasis], pdac.[Original ComCalcBasis]) as [Original ComCalcBasis], 	
		isnull(pd.ComCalcBasis, pdac.ComCalcBasis) as ComCalcBasis, 	
		isnull(pd.PaymentPlan, pdac.PaymentPlan) as PaymentPlan, 	
		isnull(pd.DoNotUse, pdac.DoNotUse) as DoNotUse, 	
		isnull(pd.NumPayments, pdac.NumPayments) as NumPayments, 

		ac.MasterAgtID as CommissionMasterAgtID,
		ac.AgtID as CommissionAgtID,

		ISNULL(ac.LastActivityPolicyCost, 0) as [Policy Cost as of Last Activity],

		ISNULL(p.PolicyCost, 0) AS [PolicyCost as of EOM] , --DK

		ISNULL(a.TotalPaid, 0) AS [Amount Collected] ,

		ISNULL(a.BadDebtWriteOffs, 0) AS [Bad Debt Write Offs] ,

		ISNULL(a.CommissionablePaid, 0) AS [Commissionable Amount Collected] ,

		--JKS 7/26/2019 - including the raw a.CommissionablePaid so we can check in the final pull whether there has ever --DK

		--been an AcctRec entered for WP policies. Otherwise if the policy's downpayment NSFs then the CommissionablePaid would --DK

		--be $0 and we would include the amount in Future even though a payment actually WAS processed --DK

		a.CommissionablePaid, --DK

		ISNULL(nc.NonCommissionablePaid, 0) AS [NonCommissionable Amount Collected] ,

		ISNULL(col.AmountCollectedAfterSentToCollections, 0) AS [Amount Collected After Sent to Collections] ,

		ISNULL(a.EOMComAdj, 0) AS [EOM Commission Adjustments for Agency Bill] ,

		ISNULL(p.PolicyCost, 0) - ISNULL(a.TotalPaid, 0) AS [Policy Balance as of EOM] , --DK

		ISNULL(p.TotalPremium, 0) AS [Total Premium] ,

		ISNULL(p.TotalTax, 0) AS [Total Taxes] ,

		ISNULL(p.TotalFee, 0) AS [Total Fees] ,

	   

		--New Commission process uses Billed amounts to determine how much to allocate to Premium for the Commissionable Amount

		ISNULL(ac.LastActivityBilledPremium, 0) as [Billed Premium],

		ISNULL(ac.LastActivityBilledTax, 0) as [Billed Tax],

		ISNULL(ac.LastActivityBilledFee, 0) as [Billed Fee],

		ISNULL(a.TotalPaid, 0) as TotalPaid,

		ISNULL(ac.TotalAllocatedPremium, 0) as [Total Allocated Basis], --DK

		ISNULL(ac.TotalAllocatedTax, 0) as [Total Allocated Tax], --DK

		ISNULL(ac.TotalAllocatedFees, 0) as [Total Allocated Fee], --DK

		

       

		--See #LastActivity creation for explanations of the Allocated buckets

		isnull(ac.TotalAllocatedCommission, 0) as [Total Allocated Commission],

		isnull(ac.UnprocessedAmount, 0) as [Direct Bill Commission not on a Statement], 

		isnull(ac.AgencyBillKept, 0) as [Commission Kept By Agent],

		isnull(ac.DirectBillCommissionPaid, 0) as [Direct Bill Commission Paid],

		isnull(ac.OutstandingDirectBillCommission, 0) as [Outstanding Direct Bill Commission],

		isnull(ac.WrittenOffCommission, 0) as [Written Off Commission],

		isnull(ac.[Waiting to Reissue Commission], 0) as [Waiting to Reissue Commission],

		isnull(ac.FutureAllocated, 0) as [Future Effective Allocated Commission],





		--adding all the allocated items that are classified as actually "Paying" the agent

		isnull(ac.AgencyBillKept, 0) + isnull(ac.DirectBillCommissionPaid, 0) + isnull(ac.WrittenOffCommission, 0) as [Commission Paid],



		-------------GROUPING THE CP AND WP COLUMNS TOGETHER AND 0ING OUT THE FIELDS IF NOT APPLICABLE TO AVOID CONFUSION--------------------------- --DK this comment is not applicable?

		----------------------------Future Due Calcs-------------------------- --DK

		CASE

			
			WHEN ac.MasterAgtID &lt;&gt; isnull(pd.MasterAgtID, pdac.MasterAgtID) then 0

			WHEN ac.AgtID &lt;&gt; isnull(pd.AgtID, pdac.AgtID) then 0
										
			--policy got sent to collections and the total amount paid covers taxes and fees
			WHEN isnull(pd.[Collections Start Date], pdac.[Collections Start Date]) IS NOT NULL

				--leave the isnull off of TotalPaid because if there's nothing paid just skip to using Total Premium

					AND isnull(a.TotalPaid, 0) &gt;= ( isnull(p.TotalFee, 0) + isnull(p.TotalTax, 0) )

				--take the total commission base less policy balance less amount collected after collections

				THEN     ISNULL(p.TotalPremium, 0)								--Premium from Installments

						- (ISNULL(p.PolicyCost, 0) - ISNULL(a.TotalPaid, 0))	--Less Overall Policy Balance

						- ISNULL(col.AmountCollectedAfterSentToCollections, 0)	--Less Amounts paid while in Collections

						- isnull(a.BadDebtWriteOffs, 0)	--DK bad debt



			--policy got sent to collections and the total amount paid isn't enough for taxes and fees

			WHEN isnull(pd.[Collections Start Date], pdac.[Collections Start Date]) IS NOT NULL

				--leave the isnull off of TotalPaid because if there's nothing paid just skip to using Total Premium

				AND isnull(a.TotalPaid, 0) &lt; ( isnull(p.TotalFee, 0) + isnull(p.TotalTax, 0) )

				--take the total commission base less the policy balance and less the portion of taxes and fees and less amount collected after collections

				THEN     ISNULL(p.TotalPremium, 0)								--Premium from Installments

						- (ISNULL(p.PolicyCost, 0) - ISNULL(a.TotalPaid, 0))	--Less Overall Policy Balance

						- (( isnull(p.TotalFee, 0) + isnull(p.TotalTax, 0) ) - isnull(a.TotalPaid, 0) )			--Less Remaining Fee and Tax Balance

						- ISNULL(col.AmountCollectedAfterSentToCollections, 0)	--Less Amounts paid while in Collections

						- isnull(a.BadDebtWriteOffs, 0)	--DK bad debt



			ELSE ISNULL(p.TotalPremium, 0) - isnull(a.BadDebtWriteOffs, 0)	--DK bad debt



		END AS [Future Due Basis] , --DK



		--round(round((isnull(p.TotalPremium, 0) - isnull(a.BadDebtWriteOffs, 0)) * (pd.ComRate1 / 100) , 2, 0) 

		--- (isnull(ac.AgencyBillKept, 0) + isnull(ac.DirectBillCommissionPaid, 0) + isnull(ac.WrittenOffCommission, 0)), 2, 0) as [Commission Balance Based on Future Due Basis], --DK commented out (calculated in final pull)

	   



		----------------------------Current Due Calcs-------------------------- --DK



CASE

	--future effective will be shown in the Future basis

	when isnull(pd.DateEffective, pdac.DateEffective) &gt; @EOMDate then 0



	--NA policies and WP policies that never had a payment are not eligible for commission so they should be showing the total expense in future

	when isnull(pd.ComCalcBasis, pdac.ComCalcBasis) = 'NA' then 0
	when isnull(pd.ComCalcBasis, pdac.ComCalcBasis) = 'WP'

		and a.CommissionablePaid is null then 0

			

	--Basis for CP will always be the total amount of premium we have allocated against from the payments

	when isnull(pd.ComCalcBasis, pdac.ComCalcBasis) = 'CP' then ISNULL(ac.TotalAllocatedPremium, 0)



	--policy got sent to collections and the total amount paid covers taxes and fees

	WHEN isnull(pd.[Collections Start Date], pdac.[Collections Start Date]) IS NOT NULL

		--leave the isnull off of TotalPaid because if there's nothing paid just skip to using Total Premium

			AND a.CommissionablePaid &gt;= ( isnull(ac.TotalAllocatedFees, 0) + isnull(ac.TotalAllocatedTax, 0) )

		--take the total commission base less policy balance less amount collected after collections

		THEN     ISNULL(ac.TotalAllocatedPremium, 0)								--Premium from Installments

				- ( ISNULL(ac.LastActivityPolicyCost, 0) - ISNULL(a.CommissionablePaid, 0))	--Less Overall Policy Balance

				- ISNULL(col.AmountCollectedAfterSentToCollections, 0)	--Less Amounts paid while in Collections



	--policy got sent to collections and the total amount paid isn't enough for taxes and fees

	WHEN isnull(pd.[Collections Start Date], pdac.[Collections Start Date]) IS NOT NULL

		--leave the isnull off of TotalPaid because if there's nothing paid just skip to using Total Premium

		AND a.CommissionablePaid &lt; ( isnull(ac.TotalAllocatedFees, 0) + isnull(ac.TotalAllocatedTax, 0) )

		--take the total commission base less the policy balance and less the portion of taxes and fees and less amount collected after collections

		THEN     ISNULL(ac.TotalAllocatedPremium, 0)	--Premium from Installments

				- (( ISNULL(ac.LastActivityPolicyCost, 0) - ISNULL(a.CommissionablePaid, 0))	--Less Overall Policy Balance

				- (( isnull(ac.TotalAllocatedFees, 0) + isnull(ac.TotalAllocatedTax, 0) ) - ISNULL(a.CommissionablePaid, 0) ))			--Less Remaining Fee and Tax Balance

				- ISNULL(col.AmountCollectedAfterSentToCollections, 0)	--Less Amounts paid while in Collections

	ELSE ISNULL(ac.TotalAllocatedPremium, 0) --DK --WP not in collections with a payment

	END as [Current Due Basis] ,  --DK

	--DK previously:		ISNULL(ac.TotalAllocatedPremium, 0) as [Current Due Basis] ,

	   

		--round(ISNULL(ac.TotalAllocatedPremium, 0) * (pd.ComRate1/100), 2, 0) as [Total Commission Expense Based on Current Due Basis] , --DK commented out (calculated in final pull)



		--round(round((ISNULL(ac.TotalAllocatedPremium, 0) * (pd.ComRate1/100)), 2, 0) 

		--	- (isnull(ac.AgencyBillKept, 0) + isnull(ac.DirectBillCommissionPaid, 0) + isnull(ac.WrittenOffCommission, 0)), 2, 0)  

		--as [Commission Balance Based on Current Due Basis], --DK commented out (calculated in final pull)



		p.[MaxInvoiceDate] ,

		mpd.MaxPremPaidDate,



		--Current Due is a combination of details that have been Processed (aka included on a statement) that are not in a Paid state (check was voided, payable wasn't paid, etc...) 

		--and records that haven't been included on a statement yet
		--JKS 11/25/2019 - for Carrie's version of the report we do not want to include Unprocessed amounts in with the Current Due
		--isnull(ac.UnprocessedAmount, 0) + isnull(ac.OutstandingDirectBillCommission, 0) as CurrentDue
		isnull(ac.OutstandingDirectBillCommission, 0) as CurrentDue


INTO   #PreTotals



FROM   #Policies pd



		--contains all of the information from the new commission process

		FULL OUTER JOIN #LastActivity ac

			ON pd.PolicyID = ac.PolicyID

			and pd.LOB = ac.LOB
			and pd.MasterAgtID = ac.MasterAgtID
			and pd.AgtID = ac.AgtID

		LEFT JOIN #Policies pdac
			ON ac.PolicyID = pdac.PolicyID
			and ac.LOB = pdac.LOB
			and pd.PolicyID is null
				


		

       --rolling up the sums of the money columns from the Installment schedule

       --JKS 11/27/2018 - per Susan Houston, changing the TotalPremium to take the total record less taxes and fees due to a large number of incorrect audits

       OUTER APPLY (   SELECT PolicyCost ,

                              TotalPremium ,

                              TotalTax ,

                              TotalFee ,

                              MaxInvoiceDate

                       FROM   #PremInvAmts pia

                       WHERE  isnull(pd.PolicyID, pdac.PolicyID) = pia.PolicyID
					   AND isnull(pd.LOB, pdac.LOB) = pia.LOB ) p



       --rolling up the total amounts paid, any commission kept for Bordereau policies, and breaking out the sum for Commissionable Receivables

       OUTER APPLY (   SELECT TotalPaid ,

                              CommKept ,

                              CommissionablePaid ,

                              --need to find out how much has been written off on the policy to reduce the amount of commission expense

                              --some of the write offs were entered as PayCom true, need to limit the bad debt to just the remaining amounts because they were already included in CommissionablePaid

                              BadDebtWriteOffs ,

                              EOMComAdj

                       FROM   #AcctRecT ar

                       WHERE  isnull(pd.PolicyID, pdac.PolicyID) = ar.PolicyID
					   AND isnull(pd.LOB, pdac.LOB) = ar.LOB ) a



		--had to move the summation of noncommissionable to it's own outer apply because we wanted to limit it to records before the policy went to collections

       OUTER APPLY (   SELECT SUM(ar.PaidPrem) AS NonCommissionablePaid

                       FROM   #AcctRecTT ar

                      WHERE  isnull(pd.PolicyID, pdac.PolicyID) = ar.PolicyID
					   AND isnull(pd.LOB, pdac.LOB) = ar.LOB
                       AND CAST(ar.EnteredDateTime AS DATE) &lt;= ISNULL(isnull(pd.[Collections Start Date], pdac.[Collections Start Date]), '1/1/2079')--) nc

					   AND ar.DateRecd &lt;= @EOMDate) nc --DK



       --gets the sum of all payments received after a policy was sent to collections

       OUTER APPLY (   SELECT SUM(ar.PaidPrem) AS AmountCollectedAfterSentToCollections

                       FROM   #AcctRecTT ar

                       WHERE  isnull(pd.PolicyID, pdac.PolicyID) = ar.PolicyID
					   AND isnull(pd.LOB, pdac.LOB) = ar.LOB
                       AND CAST(ar.EnteredDateTime AS DATE) &gt; ISNULL(isnull(pd.[Collections Start Date], pdac.[Collections Start Date]), '1/1/2079')--) col 

					   AND ar.DateRecd &lt;= @EOMDate) col --DK

		

		OUTER APPLY (   SELECT ac.MaxPremPaidDate

						FROM   #MaxPremPaidDate ac

						WHERE  isnull(pd.PolicyID, pdac.PolicyID) = ac.PolicyId
						AND isnull(pd.LOB, pdac.LOB) = ac.LOB) mpd



       option (maxdop 16);

      




--declare @EOMDate DATE = '12/31/2019', @PrevEOMDate DATE = NULL, @UseDateCancOffset bit = 1 

SELECT t.PolicyID ,

		t.ReportDate ,

		t.FirmID ,

		t.UwOfc ,

		t.MasterAgtID, --DK

		t.AgtId ,

		t.CommissionMasterAgtID,

		t.CommissionAgtID,

		t.AgtName ,

		t.AgtGroup ,

		t.DateBound ,

		t.LOB ,

		t.Policy ,

		t.InsName ,

		t.DateEffective ,

		t.DateAudit ,

		t.DateCanc ,

		t.[Collections Start Date] ,

		CASE

			--JKS 7/31/2019 - added DateAudit and Use Date Canc Offset validation when determining if something was adjusted

			WHEN  t.DateCanc BETWEEN DATEADD(d, -30, @EOMDate) and @EOMDate 

				and t.DateAudit is null 

				and @UseDateCancOffset = 1 

				and #canc.policyid is null

				and t.DateCanc &lt;&gt; t.DateEffective

				and t.ComCalcBasis &lt;&gt; 'cp'

				THEN 'Pending Canceled - adjusted'

			WHEN  t.DateCanc &gt; @EOMDate 

				and t.DateAudit is null 

				and @UseDateCancOffset = 1  

				and #canc.policyid is null

				and t.DateCanc &lt;&gt; t.DateEffective

				THEN 'Future Canceled - adjusted'

			WHEN  t.DateCanc &lt; @EOMDate THEN 'Canceled - NOT adjusted'

			ELSE 'N/A - NOT adjusted'

			END AS [Pending Cancel] , --DK

		t.BillType ,

		t.PaymentPlan ,

		t.ComRate1 ,

		t.[Migrated Policy] ,

		t.NoRefund ,

		t.StopInvoice ,

		t.StopAuditInvoice ,

		CASE

			WHEN t.[CommissionablePaid] is not null THEN 'Y'

			ELSE 'N'

			END AS [CommissionablePaid Exists] , --flag for a.CommissionablePaid is not null then 1, if null then 0 (AR activity on policy) --DK

		t.[NumPayments] , --DK

		t.[Original ComCalcBasis] ,

		t.ComCalcBasis ,

		t.[Policy Cost as of Last Activity],

		t.[PolicyCost as of EOM] , --DK

		t.[Amount Collected] ,

		t.[Bad Debt Write Offs] ,

		t.[Commissionable Amount Collected] ,

		t.[NonCommissionable Amount Collected] ,

		t.[Amount Collected After Sent to Collections] ,

		t.[EOM Commission Adjustments for Agency Bill] ,

		t.[Policy Balance as of EOM] , --DK

		t.[Total Premium] ,

		t.[Total Taxes] ,

		t.[Total Fees] ,

		

		t.[Billed Premium],

		t.[Billed Tax],

		t.[Billed Fee],

		t.[Total Allocated Basis], --DK

		t.[Total Allocated Tax], --DK

		t.[Total Allocated Fee], --DK

		

		t.[Total Allocated Commission],

		t.[Direct Bill Commission not on a Statement], 

		t.[Commission Kept By Agent],

		t.[Direct Bill Commission Paid],

		t.[Outstanding Direct Bill Commission],

		t.[Written Off Commission],

		t.[Waiting to Reissue Commission],

		t.[Future Effective Allocated Commission],

		

		t.[Future Due Basis] , --DK

		ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0) AS [Total Commission Expense Based on Future Due Basis] , --DK



		CASE
			--		1000 &lt;&gt; 1100
			WHEN t.CommissionMasterAgtID &lt;&gt; t.MasterAgtID then 0

			WHEN t.CommissionAgtID &lt;&gt; t.AgtID then 0

			ELSE ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0)
				- (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0) 
		END as [Commission Balance Based on Future Due Basis], --DK


		t.[Current Due Basis] , --DK

		ROUND(t.[Current Due Basis] * ( t.ComRate1 / 100 ), 2, 0) AS [Total Commission Expense Based on Current Due Basis] , --DK

		round(ROUND(t.[Current Due Basis] * ( t.ComRate1 / 100 ), 2, 0) 

				- (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0)  

			as [Commission Balance Based on Current Due Basis], --DK



	--CASE 

	--		--For Effective Collected and Not Applicable policies that have something in Commissionable Amount Collected 

	--		WHEN t.ComCalcBasis in('CP', 'NA')

 --                AND t.[Commissionable Amount Collected] &lt;&gt; 0

 --                AND t.dateeffective &lt;= @EOMDate

 --                AND (   @PrevEOMDate IS NULL

 --                        OR t.dateeffective &gt; @PrevEOMDate ) 

			

	--		THEN (ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0))  --DK [Commission Balance Based on Future Due Basis]

	--		- (round(ROUND(t.[Current Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0)) --DK [Commission Balance Based on Current Due Basis]

                

 --           WHEN t.ComCalcBasis  in( 'CP', 'NA')

 --                AND t.[Commissionable Amount Collected] = 0

 --                AND t.dateeffective &lt;= @EOMDate

 --                AND (   @PrevEOMDate IS NULL

 --                        OR t.dateeffective &gt; @PrevEOMDate ) 

	--		--THEN  ROUND((ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0))  --DK [Commission Balance Based on Future Due Basis]

	--		--		- ROUND(( t.[Commissionable Amount Collected] ) * ( t.ComRate1 / 100 ) , 2 , 0) - ( t.[Commission Paid] ) , 2 , 0)

	--		THEN  (ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0))  --DK [Commission Balance Based on Future Due Basis]

	--		 - (round( t.[Commissionable Amount Collected] * round( t.ComRate1 / 100, 2), 2) - t.[Commission Paid]) --DK revision from 7/23 to simplify parenthesis bc some of this calc was not working properly



	--		WHEN t.ComCalcBasis = 'WP'

	--			AND t.dateeffective &lt;= @EOMDate

 --               AND t.TotalPaid = 0

	--			AND (   @PrevEOMDate IS NULL

 --                        OR t.dateeffective &gt; @PrevEOMDate ) 

	--		THEN (ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0))  --DK [Commission Balance Based on Future Due Basis]

				 				

 --           ELSE 0 

 --   END AS [Future Commission Expense] , --DK

		CASE

			WHEN t.DateEffective &lt;= @EOMDate

			THEN (		CASE
						--		1000 &lt;&gt; 1100
						WHEN t.CommissionMasterAgtID &lt;&gt; t.MasterAgtID then 0

						WHEN t.CommissionAgtID &lt;&gt; t.AgtID then 0

						ELSE ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0)
							- (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0) 
						END)  --DK [Commission Balance Based on Future Due Basis]

			- t.CurrentDue

            ELSE 0

       END AS [Future Commission Expense] ,



	  t.CurrentDue as [Current Commission Due] , --DK changing back to Jerami calc per susan 7/31



       --commission for future policies

       CASE 

			WHEN t.DateEffective &gt; @EOMDate 

			THEN (ROUND(ROUND(t.[Future Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0))  --DK [Commission Balance Based on Future Due Basis]

			-t.CurrentDue --DK compensate for those in allocated commission in June (should not have an effect in July)

            ELSE 0

       END AS [Commission for Future Policies] ,

       

       t.DoNotUse ,

       --cast(0 as Money) as [FutureBucket],

       --cast(0 as Money) as [NegativeBucket],

       CAST(0 AS MONEY) AS [0to30Bucket] ,

       CAST(0 AS MONEY) AS [30to60Bucket] ,

       CAST(0 AS MONEY) AS [60to90Bucket] ,

       CAST(0 AS MONEY) AS [90to180Bucket] ,

       CAST(0 AS MONEY) AS [180to365Bucket] ,

       CAST(0 AS MONEY) AS [More365Bucket] ,

       t.[MaxInvoiceDate] ,


       t.[MaxPremPaidDate]



		--calculated current due       

	  ,round(ROUND(t.[Current Due Basis] * ( t.ComRate1 / 100 ), 2, 0) 

						- (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0)  

					as [Calculated Current Commission Due] --DK

	  

	  ,CASE

			WHEN round(t.CurrentDue, 1) = round( (round(ROUND(t.[Current Due Basis] * ( t.ComRate1 / 100 ), 2, 0) - (isnull(t.[Commission Kept By Agent], 0) + isnull(t.[Direct Bill Commission Paid], 0) + isnull(t.[Written Off Commission], 0)), 2, 0)) , 1) THEN 'Y'

			ELSE 'N' 

			END AS 'AFSI CurrentDue = Current Commission Due (to nearest .10)'

INTO   #Totals

FROM   #PreTotals t

LEFT JOIN #canc

ON t.LOB = #canc.LOB AND t.PolicyID = #canc.policyid

option (maxdop 16);




UPDATE a

SET

    --a.[FutureBucket] = [Future Commission Expense Based on Amount Collected] + [Commission for Future Policies],

    --a.[NegativeBucket] = CASE WHEN [Current Commission Due] &lt; 0 THEN [Current Commission Due] ELSE 0 END,

       a.[0to30Bucket] = CASE WHEN DATEDIFF(

                                       DAY ,

                                       coalesce(

                                           a.DateAudit, 

										   a.DateCanc,

                                           CASE WHEN a.ComCalcBasis in ('CP', 'NA') THEN a.[MaxPremPaidDate] ELSE NULL END,

                                           a.[MaxInvoiceDate],

										   @EOMDate),

                                       @EOMDate) &lt;=  29 								   

								    THEN

                                  [Current Commission Due]

                              ELSE 0

                         END ,

       a.[30to60Bucket] = CASE WHEN DATEDIFF(

                                        DAY ,

                                        coalesce(

                                           a.DateAudit, 

										   a.DateCanc,

                                           CASE WHEN a.ComCalcBasis  in ('CP', 'NA') THEN a.[MaxPremPaidDate] ELSE NULL END,

                                           a.[MaxInvoiceDate],

										   @EOMDate),

                                        @EOMDate)

                                    BETWEEN 30 AND 59 THEN

                                   [Current Commission Due]

                               ELSE 0

                          END ,

       a.[60to90Bucket] = CASE WHEN DATEDIFF(

                                        DAY ,

                                        coalesce(

                                           a.DateAudit, 

										   a.DateCanc,

                                           CASE WHEN a.ComCalcBasis  in ('CP', 'NA') THEN a.[MaxPremPaidDate] ELSE NULL END,

                                           a.[MaxInvoiceDate],

										   @EOMDate),

                                        @EOMDate)

                                    BETWEEN 60 AND 89 THEN

                                   [Current Commission Due]

                               ELSE 0

                          END ,

       a.[90to180Bucket] = CASE WHEN DATEDIFF(

                                         DAY ,

                                         coalesce(

                                           a.DateAudit, 

										   a.DateCanc,

                                           CASE WHEN a.ComCalcBasis  in ('CP', 'NA') THEN a.[MaxPremPaidDate] ELSE NULL END,

                                           a.[MaxInvoiceDate],

										   @EOMDate),

                                         @EOMDate)

                                     BETWEEN 90 AND 179 THEN

                                    [Current Commission Due]

                                ELSE 0

                           END ,

       a.[180to365Bucket] = CASE WHEN DATEDIFF(

                                          DAY ,

                                          coalesce(

                                           a.DateAudit, 

										   a.DateCanc,

                                           CASE WHEN a.ComCalcBasis  in ('CP', 'NA') THEN a.[MaxPremPaidDate] ELSE NULL END,

                                           a.[MaxInvoiceDate],

										   @EOMDate),

                                          @EOMDate)

                                      BETWEEN 180 AND 364 THEN

                                     [Current Commission Due]

                                 ELSE 0

                            END ,

       a.[More365Bucket] = CASE WHEN DATEDIFF(

                                         DAY ,

                                         coalesce(

                                           a.DateAudit, 

										   a.DateCanc,

                                           CASE WHEN a.ComCalcBasis  in ('CP', 'NA') THEN a.[MaxPremPaidDate] ELSE NULL END,

                                           a.[MaxInvoiceDate],

										   @EOMDate),

                                         @EOMDate) &gt;= 365 THEN

                                    [Current Commission Due]

                                ELSE 0

                           END

FROM   #Totals a

option (maxdop 16);








select *
into #Statements
from Accounting.dbo.Payables p (nolock)
outer apply (select sum(ac.CommAmt) as PmtAmt
				from Accounting.dbo.AFSICommission ac (nolock)
				where p.PayableID = ac.PayableID
				and ac.RecType in('CBALP', 'REVCBALP', 'CTRFR', 'RFEE')) hp
where p.RecType in('CPBL', 'DUE')
and JSON_VALUE(p.SupportingInfo, '$.MIGRATED') is null
and cast(p.EnteredDateTime as date) &lt;= '12/31/2019'



select s.ParentID, max(s.PayableID) as LastStatementID
into #LastStatement
from #Statements s
group by s.ParentID


select ls.*, s.StatementAmt, s.StatementDate
into #DUEs
from #LastStatement ls
inner join #Statements s
	on ls.LastStatementID = s.PayableID
	and s.RecType = 'DUE'

	
	
SELECT 
		[MasterAgtID],
		[AgtId] ,
		[CommissionMasterAgtID],
		[CommissionAgtID],
        [AgtName] ,
		[LOB] ,
		[Policy] ,
        [InsName] ,
        [DateEffective] ,
        [DateAudit] ,
        [DateCanc] ,
		[ComRate1] ,
		[Collections Start Date] ,
        [Original ComCalcBasis] ,
        [ComCalcBasis] ,
        [Policy Cost as of Last Activity] as [PolicyCost] ,
        [Amount Collected] ,
        [Commissionable Amount Collected] ,
        [NonCommissionable Amount Collected] ,
        [Amount Collected After Sent to Collections] ,
        t.[Total Allocated Basis] as [Total Allocated Premium], --DK
		t.[Total Allocated Tax], --DK
		t.[Total Allocated Fee],
        t.[Commission Kept By Agent],
		t.[Direct Bill Commission Paid],
		t.[Outstanding Direct Bill Commission],
		t.[Written Off Commission],
        [Current Commission Due] ,
		[Calculated Current Commission Due],
		[Waiting to Reissue Commission],
        [0to30Bucket] ,
        [30to60Bucket] ,
        [60to90Bucket] ,
        [90to180Bucket] ,
        [180to365Bucket] ,
        [More365Bucket] ,
		[Commission Balance Based on Future Due Basis],
		t.firmid,
		t.PolicyID
into #Report
FROM   #Totals t
inner join #DUEs d
	on t.CommissionMasterAgtID = d.ParentID
where 1 = case
				when t.[Current Commission Due] &lt;&gt; 0 then 1
				when t.[Commission Balance Based on Future Due Basis] &lt;&gt; 0 then 1 --DK
				when t.[Commission Balance Based on Current Due Basis] &lt;&gt; 0 then 1
				when t.[Future Commission Expense] &lt;&gt; 0 then 1 --DK
				when t.[Commission for Future Policies] &lt;&gt; 0 then 1
				when t.[Calculated Current Commission Due] &lt;&gt; 0 then 1 --DK
				when t.[Waiting to Reissue Commission] &lt;&gt; 0 then 1
				else 0
			end
order by t.AgtId

option (maxdop 16);



--check to see if the sum of the policy level outstanding commission matches the last statement amount
--*****NOTE: the difference can be caused by DUE statements with a Credit Balance Payment, Reversed Credit Balance Payment (pmt applied to wrong agent) or a Returned NSF Fee
-------------that is at the agent level only. To combat this I'm pulling all statement to totals out of balances then making sure the differences are from the Agent level activity
select r.CommissionMasterAgtID, d.LastStatementID, d.StatementDate, isnull(d.StatementAmt, 0) as StatementAmt, sum(r.[Current Commission Due]) as TotalBalance
into #OOB
from #Report r
inner join #DUEs d
	on r.CommissionMasterAgtID = d.ParentID
--where r.agtid = 117259
group by r.CommissionMasterAgtID, d.LastStatementID, d.StatementDate, isnull(d.StatementAmt, 0)
having sum(r.[Current Commission Due]) &lt;&gt; isnull(d.StatementAmt, 0)



--validation that everything is accounted for, should return no records
--select o.CommissionMasterAgtID, o.LastStatementID, o.StatementAmt, s.PayableID, s.StatementDate, s.RecType, s.CheckDescr, s.StatementAmt, s.CurrentAmt, s.PmtAmt, pt.TotalPmts, o.TotalBalance - o.StatementAmt as Diff
--from #OOB o
--inner join #Statements s
--	on o.CommissionMasterAgtID = s.ParentID
--	--and s.CurrentAmt &lt;&gt; 0
--outer apply (select sum(s2.PmtAmt) as TotalPmts
--				from #Statements s2
--				where o.CommissionMasterAgtID = s2.ParentID
--				and s2.RecType = 'DUE' ) pt
--where abs((o.TotalBalance - o.StatementAmt)) - abs(isnull(pt.TotalPmts, 0)) &lt;&gt; 0

--order by o.CommissionMasterAgtID--, s.StatementDate


--declare @EOMDate DATE = '12/31/2019'
select o.CommissionMasterAgtID as MasterAgtID, a.AgtName, 'AGT' as LOB, ac.CommAmt as [Current Commission Due], ac.Eligible, ac.Descr as InsName,
case
	when datediff(d, Eligible, @EOMDate) &lt;= 30 then ac.CommAmt
	else 0
end as [0to30Bucket] ,
case
	when datediff(d, Eligible, @EOMDate) between 31 and 60 then ac.CommAmt
	else 0
end as [30to60Bucket] ,
case
	when datediff(d, Eligible, @EOMDate) between 61 and 90 then ac.CommAmt
	else 0
end as [60to90Bucket] ,
case
	when datediff(d, Eligible, @EOMDate) between 91 and 180 then ac.CommAmt
	else 0
end as [90to180Bucket] ,
case
	when datediff(d, Eligible, @EOMDate) between 181 and 365 then ac.CommAmt
	else 0
end as [180to365Bucket] ,
case
	when datediff(d, Eligible, @EOMDate) &gt; 365 then ac.CommAmt
	else 0
end as [More365Bucket]
into #SuspenseItems
from #OOB o
inner join #Statements s
	on o.CommissionMasterAgtID = s.ParentID
	and s.RecType = 'DUE'
inner join Accounting.dbo.AFSICommission ac (nolock)
	on o.CommissionMasterAgtID = ac.MasterAgtID
	and s.PayableID = ac.PayableID
	and ac.RecType in('CBALP', 'REVCBALP', 'CTRFR', 'RFEE')
inner join Premdat.dbo.Agents a (nolock)
	on o.CommissionMasterAgtID = a.AgtID



SELECT 
		[MasterAgtID],
		[AgtId] ,
		[CommissionMasterAgtID],
		[CommissionAgtID],
        [AgtName] ,
		[LOB] ,
		[Policy] ,
        [InsName] ,
        [DateEffective] ,
        [DateAudit] ,
        [DateCanc] ,
		[ComRate1] ,
		[Collections Start Date] ,
        [Original ComCalcBasis] ,
        [ComCalcBasis] ,
        [PolicyCost] ,
        [Amount Collected] ,
        [Commissionable Amount Collected] ,
        [NonCommissionable Amount Collected] ,
        [Amount Collected After Sent to Collections] ,
        [Total Allocated Premium], --DK
		[Total Allocated Tax], --DK
		[Total Allocated Fee],
        [Commission Kept By Agent],
		[Direct Bill Commission Paid],
		[Outstanding Direct Bill Commission],
		[Written Off Commission],
        [Current Commission Due] ,
		[Calculated Current Commission Due],
		[Waiting to Reissue Commission],
        [0to30Bucket] ,
        [30to60Bucket] ,
        [60to90Bucket] ,
        [90to180Bucket] ,
        [180to365Bucket] ,
        [More365Bucket] ,
		[Commission Balance Based on Future Due Basis]
from #Report r

union all

SELECT 
		s.[MasterAgtID],
		s.[MasterAgtID] as [AgtId] ,
		s.[MasterAgtID] as [CommissionMasterAgtID],
		s.[MasterAgtID] as [CommissionAgtID],
        s.[AgtName] ,
		s.[LOB] ,
		'' as [Policy] ,
        s.[InsName] ,
        '' as [DateEffective] ,
        '' as [DateAudit] ,
        '' as [DateCanc] ,
		'' as [ComRate1] ,
		'' as [Collections Start Date] ,
        '' as [Original ComCalcBasis] ,
        '' as [ComCalcBasis] ,
        0 as [PolicyCost] ,
        0 as [Amount Collected] ,
        0 as [Commissionable Amount Collected] ,
        0 as [NonCommissionable Amount Collected] ,
        0 as [Amount Collected After Sent to Collections] ,
        0 as [Total Allocated Premium], --DK
		0 as [Total Allocated Tax], --DK
		0 as [Total Allocated Fee],
        0 as [Commission Kept By Agent],
		0 as [Direct Bill Commission Paid],
		0 as [Outstanding Direct Bill Commission],
		0 as [Written Off Commission],
        s.[Current Commission Due] ,
		s.[Current Commission Due] as [Calculated Current Commission Due],
		0 as [Waiting to Reissue Commission],
        s.[0to30Bucket] ,
        s.[30to60Bucket] ,
        s.[60to90Bucket] ,
        s.[90to180Bucket] ,
        s.[180to365Bucket] ,
        s.[More365Bucket] ,
		0 as [Commission Balance Based on Future Due Basis]
from #SuspenseItems s

order by MasterAgtID

drop table #Report, #LastStatement, #DUEs, #Statements</CommandText>
        <rd:UseGenericDesigner>true</rd:UseGenericDesigner>
      </Query>
      <Fields>
        <Field Name="MasterAgtID">
          <DataField>MasterAgtID</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="AgtId">
          <DataField>AgtId</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="CommissionMasterAgtID">
          <DataField>CommissionMasterAgtID</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="CommissionAgtID">
          <DataField>CommissionAgtID</DataField>
          <rd:TypeName>System.Int32</rd:TypeName>
        </Field>
        <Field Name="AgtName">
          <DataField>AgtName</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="LOB">
          <DataField>LOB</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="Policy">
          <DataField>Policy</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="InsName">
          <DataField>InsName</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="DateEffective">
          <DataField>DateEffective</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="DateAudit">
          <DataField>DateAudit</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="DateCanc">
          <DataField>DateCanc</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="ComRate1">
          <DataField>ComRate1</DataField>
          <rd:TypeName>System.Single</rd:TypeName>
        </Field>
        <Field Name="Collections_Start_Date">
          <DataField>Collections Start Date</DataField>
          <rd:TypeName>System.DateTime</rd:TypeName>
        </Field>
        <Field Name="Original_ComCalcBasis">
          <DataField>Original ComCalcBasis</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="ComCalcBasis">
          <DataField>ComCalcBasis</DataField>
          <rd:TypeName>System.String</rd:TypeName>
        </Field>
        <Field Name="PolicyCost">
          <DataField>PolicyCost</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Amount_Collected">
          <DataField>Amount Collected</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Commissionable_Amount_Collected">
          <DataField>Commissionable Amount Collected</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="NonCommissionable_Amount_Collected">
          <DataField>NonCommissionable Amount Collected</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Amount_Collected_After_Sent_to_Collections">
          <DataField>Amount Collected After Sent to Collections</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Total_Allocated_Premium">
          <DataField>Total Allocated Premium</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Total_Allocated_Tax">
          <DataField>Total Allocated Tax</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Total_Allocated_Fee">
          <DataField>Total Allocated Fee</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Commission_Kept_By_Agent">
          <DataField>Commission Kept By Agent</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Direct_Bill_Commission_Paid">
          <DataField>Direct Bill Commission Paid</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Outstanding_Direct_Bill_Commission">
          <DataField>Outstanding Direct Bill Commission</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Written_Off_Commission">
          <DataField>Written Off Commission</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Current_Commission_Due">
          <DataField>Current Commission Due</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Calculated_Current_Commission_Due">
          <DataField>Calculated Current Commission Due</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
        <Field Name="Waiting_to_Reissue_Commission">
          <DataField>Waiting to Reissue Commission</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="ID0to30Bucket">
          <DataField>0to30Bucket</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="ID30to60Bucket">
          <DataField>30to60Bucket</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="ID60to90Bucket">
          <DataField>60to90Bucket</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="ID90to180Bucket">
          <DataField>90to180Bucket</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="ID180to365Bucket">
          <DataField>180to365Bucket</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="More365Bucket">
          <DataField>More365Bucket</DataField>
          <rd:TypeName>System.Decimal</rd:TypeName>
        </Field>
        <Field Name="Commission_Balance_Based_on_Future_Due_Basis">
          <DataField>Commission Balance Based on Future Due Basis</DataField>
          <rd:TypeName>System.Double</rd:TypeName>
        </Field>
      </Fields>
    </DataSet>
  </DataSets>
  <ReportSections>
    <ReportSection>
      <Body>
        <ReportItems>
          <Textbox Name="textbox1">
            <CanGrow>true</CanGrow>
            <KeepTogether>true</KeepTogether>
            <Paragraphs>
              <Paragraph>
                <TextRuns>
                  <TextRun>
                    <Value>Direct Bill Aging</Value>
                    <Style>
                      <FontFamily>Segoe UI Light</FontFamily>
                      <FontSize>24pt</FontSize>
                      <FontWeight>Bold</FontWeight>
                    </Style>
                  </TextRun>
                </TextRuns>
                <Style />
              </Paragraph>
            </Paragraphs>
            <rd:DefaultName>textbox1</rd:DefaultName>
            <Height>0.43in</Height>
            <Width>37in</Width>
            <Style>
              <PaddingLeft>2pt</PaddingLeft>
              <PaddingRight>2pt</PaddingRight>
              <PaddingTop>2pt</PaddingTop>
              <PaddingBottom>2pt</PaddingBottom>
            </Style>
          </Textbox>
          <Tablix Name="table1">
            <TablixBody>
              <TablixColumns>
                <TablixColumn>
                  <Width>1.16667in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>0.83333in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.61458in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.38542in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.59375in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>0.63542in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.51042in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.96875in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.26042in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.82292in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.88542in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.28125in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.0625in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.41667in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.72917in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>3.01042in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>3.32292in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.10416in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.5625in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.54167in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.125in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.15625in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.76042in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.8125in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>2.52083in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.20833in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.30208in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.30208in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.4375in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.4375in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>1.33333in</Width>
                </TablixColumn>
                <TablixColumn>
                  <Width>3.90625in</Width>
                </TablixColumn>
              </TablixColumns>
              <TablixRows>
                <TablixRow>
                  <Height>0.22in</Height>
                  <TablixCells>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox2">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Master Agt ID</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox2</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox3">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Agt Id</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox3</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox4">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Comm Master Agt ID</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox4</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox5">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Comm Agt ID</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox5</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox6">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Agt Name</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox6</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox7">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>LOB</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox7</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox8">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Policy</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox8</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox9">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Ins Name</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox9</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox10">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Date Effective</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox10</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox11">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Date Audit</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox11</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox12">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Date Canc</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox12</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox13">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Com Rate1</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox13</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox14">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Collections Start Date</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox14</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox15">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Original Com Calc Basis</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox15</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox16">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Com Calc Basis</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox16</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox17">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Policy Cost</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox17</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox18">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Amount Collected</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox18</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox19">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Commissionable Amount Collected</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox19</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox20">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Non Commissionable Amount Collected</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox20</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox21">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Amount Collected After Sent to Collections</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox21</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox22">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Total Allocated Premium</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox22</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox23">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Total Allocated Tax</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox23</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox24">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Total Allocated Fee</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox24</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox25">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Commission Kept By Agent</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox25</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox26">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Direct Bill Commission Paid</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox26</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox27">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Outstanding Direct Bill Commission</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox27</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox28">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Written Off Commission</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox28</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox29">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Current Commission Due</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox29</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox30">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Calculated Current Commission Due</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox30</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox31">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Waiting to Reissue Commission</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox31</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox32">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>ID0to30Bucket</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox32</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox33">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>ID30to60Bucket</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox33</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox34">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>ID60to90Bucket</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox34</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox35">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>ID90to180Bucket</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox35</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox36">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>ID180to365Bucket</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox36</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox37">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>More365Bucket</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox37</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="textbox38">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>Commission Balance Based on Future Due Basis</Value>
                                  <Style>
                                    <FontFamily />
                                    <FontSize>11pt</FontSize>
                                    <FontWeight>Bold</FontWeight>
                                    <Color>#666666</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style>
                                <FontFamily />
                                <TextAlign>Right</TextAlign>
                              </Style>
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>textbox38</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                  </TablixCells>
                </TablixRow>
                <TablixRow>
                  <Height>0.21in</Height>
                  <TablixCells>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="MasterAgtID">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!MasterAgtID.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>MasterAgtID</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="AgtId">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!AgtId.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>AgtId</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="CommissionMasterAgtID">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!CommissionMasterAgtID.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>CommissionMasterAgtID</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="CommissionAgtID">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!CommissionAgtID.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>CommissionAgtID</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="AgtName">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!AgtName.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>AgtName</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="LOB">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!LOB.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>LOB</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Policy">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Policy.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Policy</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="InsName">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!InsName.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>InsName</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="DateEffective">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!DateEffective.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>d</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>DateEffective</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="DateAudit">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!DateAudit.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>d</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>DateAudit</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="DateCanc">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!DateCanc.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>d</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>DateCanc</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ComRate1">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ComRate1.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ComRate1</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Collections_Start_Date">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Collections_Start_Date.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>d</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Collections_Start_Date</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Original_ComCalcBasis">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Original_ComCalcBasis.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Original_ComCalcBasis</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ComCalcBasis">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ComCalcBasis.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ComCalcBasis</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="PolicyCost">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!PolicyCost.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'0;('$'0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>PolicyCost</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Amount_Collected">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Amount_Collected.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'0;('$'0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Amount_Collected</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Commissionable_Amount_Collected">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Commissionable_Amount_Collected.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'0;('$'0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Commissionable_Amount_Collected</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="NonCommissionable_Amount_Collected">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!NonCommissionable_Amount_Collected.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'0;('$'0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>NonCommissionable_Amount_Collected</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Amount_Collected_After_Sent_to_Collections">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Amount_Collected_After_Sent_to_Collections.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'0;('$'0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Amount_Collected_After_Sent_to_Collections</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Total_Allocated_Premium">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Total_Allocated_Premium.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Total_Allocated_Premium</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Total_Allocated_Tax">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Total_Allocated_Tax.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Total_Allocated_Tax</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Total_Allocated_Fee">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Total_Allocated_Fee.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Total_Allocated_Fee</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Commission_Kept_By_Agent">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Commission_Kept_By_Agent.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Commission_Kept_By_Agent</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Direct_Bill_Commission_Paid">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Direct_Bill_Commission_Paid.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Direct_Bill_Commission_Paid</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Outstanding_Direct_Bill_Commission">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Outstanding_Direct_Bill_Commission.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Outstanding_Direct_Bill_Commission</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Written_Off_Commission">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Written_Off_Commission.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Written_Off_Commission</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Current_Commission_Due">
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Current_Commission_Due.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Current_Commission_Due</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Calculated_Current_Commission_Due">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Calculated_Current_Commission_Due.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Format>'$'#,0;('$'#,0)</Format>
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Calculated_Current_Commission_Due</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                            <rd:FormatSymbolCulture>en-US</rd:FormatSymbolCulture>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Waiting_to_Reissue_Commission">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Waiting_to_Reissue_Commission.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Waiting_to_Reissue_Commission</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ID0to30Bucket">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ID0to30Bucket.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ID0to30Bucket</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ID30to60Bucket">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ID30to60Bucket.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ID30to60Bucket</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ID60to90Bucket">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ID60to90Bucket.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ID60to90Bucket</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ID90to180Bucket">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ID90to180Bucket.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ID90to180Bucket</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="ID180to365Bucket">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!ID180to365Bucket.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>ID180to365Bucket</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="More365Bucket">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!More365Bucket.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>More365Bucket</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                    <TablixCell>
                      <CellContents>
                        <Textbox Name="Commission_Balance_Based_on_Future_Due_Basis">
                          <CanGrow>true</CanGrow>
                          <KeepTogether>true</KeepTogether>
                          <Paragraphs>
                            <Paragraph>
                              <TextRuns>
                                <TextRun>
                                  <Value>=Fields!Commission_Balance_Based_on_Future_Due_Basis.Value</Value>
                                  <Style>
                                    <FontFamily />
                                    <Color>#333333</Color>
                                  </Style>
                                </TextRun>
                              </TextRuns>
                              <Style />
                            </Paragraph>
                          </Paragraphs>
                          <rd:DefaultName>Commission_Balance_Based_on_Future_Due_Basis</rd:DefaultName>
                          <Style>
                            <Border>
                              <Color>LightGrey</Color>
                            </Border>
                            <BottomBorder>
                              <Style>Solid</Style>
                            </BottomBorder>
                            <BackgroundColor>=IIF(ROWNUMBER(NOTHING) MOD 2, "White", "WhiteSmoke")</BackgroundColor>
                            <FontFamily />
                            <PaddingLeft>2pt</PaddingLeft>
                            <PaddingRight>2pt</PaddingRight>
                            <PaddingTop>2pt</PaddingTop>
                            <PaddingBottom>2pt</PaddingBottom>
                          </Style>
                        </Textbox>
                      </CellContents>
                    </TablixCell>
                  </TablixCells>
                </TablixRow>
              </TablixRows>
            </TablixBody>
            <TablixColumnHierarchy>
              <TablixMembers>
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
                <TablixMember />
              </TablixMembers>
            </TablixColumnHierarchy>
            <TablixRowHierarchy>
              <TablixMembers>
                <TablixMember>
                  <KeepWithGroup>After</KeepWithGroup>
                  <RepeatOnNewPage>true</RepeatOnNewPage>
                  <KeepTogether>true</KeepTogether>
                </TablixMember>
                <TablixMember>
                  <Group Name="table1_Details_Group">
                    <DataElementName>Detail</DataElementName>
                  </Group>
                  <TablixMembers>
                    <TablixMember />
                  </TablixMembers>
                  <DataElementName>Detail_Collection</DataElementName>
                  <DataElementOutput>Output</DataElementOutput>
                  <KeepTogether>true</KeepTogether>
                </TablixMember>
              </TablixMembers>
            </TablixRowHierarchy>
            <DataSetName>DataSet1</DataSetName>
            <Top>0.43in</Top>
            <Height>0.43in</Height>
            <Width>67.01042in</Width>
            <ZIndex>1</ZIndex>
            <Style />
          </Tablix>
        </ReportItems>
        <Height>0.86in</Height>
        <Style />
      </Body>
      <Width>68.44792in</Width>
      <Page>
        <LeftMargin>1in</LeftMargin>
        <RightMargin>1in</RightMargin>
        <TopMargin>1in</TopMargin>
        <BottomMargin>1in</BottomMargin>
        <Style />
      </Page>
    </ReportSection>
  </ReportSections>
  <ReportParametersLayout>
    <GridLayoutDefinition>
      <NumberOfColumns>4</NumberOfColumns>
      <NumberOfRows>2</NumberOfRows>
    </GridLayoutDefinition>
  </ReportParametersLayout>
  <Language>en-US</Language>
  <ConsumeContainerWhitespace>true</ConsumeContainerWhitespace>
  <rd:ReportUnitType>Inch</rd:ReportUnitType>
  <rd:ReportID>c38d9317-bef6-4704-b76a-05a1913d56de</rd:ReportID>
</Report>